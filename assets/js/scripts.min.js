/*!
 * gulp-nunjucks-sass-template
 * A Gulp 4 template including SCSS, Nunjucks, JS and more
 *
 * Url: https://github.com/DefaultSimon
 * Author: Simon GoriÄar
 * Copyright 2022. License: MIT
 */
window.onload=function(){const e=new IntersectionObserver(function(e,t){e.forEach(e=>{e.isIntersecting?(e.target.classList.remove("animate-off"),e.target.classList.add("animate")):(e.target.classList.remove("animate"),e.target.classList.add("animate-off"))})},{root:null,rootMargin:"24px",threshold:.5});function t(e){let t=window.innerWidth/2,n=window.innerHeight/2,s=e.clientX,a=e.clientY;this.querySelectorAll(".parallaxed").forEach((e,i)=>{let o=-.001*i-.001;e.style.marginLeft=`${(s-t)*o}%`,e.style.marginTop=`${(a-n)*o}%`})}document.querySelectorAll("section").forEach(t=>e.observe(t)),document.querySelectorAll(".parallax").forEach(e=>{e.addEventListener("mousemove",t)});const n=document.querySelectorAll(".section");let s=!1;function a(e,t,n,a){s=!0;let i=null,o=window.pageYOffset||document.documentElement.scrollTop,c=window.innerHeight,r=0,l=0;r="center"===a?t?(c+e.offsetHeight)/2:e.parentElement.getBoundingClientRect().top+(c+e.offsetHeight)/2:"bottom"===a?e.parentElement.getBoundingClientRect().bottom-c:e.getBoundingClientRect().top,console.log(o,r,l,e),function(){const e=["ms","moz","webkit","o"];for(let t=0,n=e.length;t<n&&!window.requestAnimationFrame;t++)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"]}(),window.requestAnimationFrame(function a(c){i||(i=c||(new Date).getTime());let d=(c-i)/+n;d=+d.toFixed(2);let m=+(f=d,f*(2-f)).toFixed(2);var f;l=+(l=o+r*m).toFixed(2),window.scrollTo(0,l),isNaN(l)||l<0||!t&&l<=0||!t&&l<=o+r+1||t&&l>=o+r||t&&l>=document.body.clientHeight-window.innerHeight-1||l>document.body.clientHeight-window.innerHeight?(cancelAnimationFrame(i),e&&e.focus(),l=0,s=!1):window.requestAnimationFrame(a)})}function i(e,t,n,s){!n&&t.offsetHeight<window.innerHeight||(e.classList.add("animate-fade"),t.classList.remove("animate-fade"))}function o(e){e.preventDefault();let t=e.deltaY>0;if(!s){let e,o=Array.from(n).findIndex(e=>e.classList.contains("animate"));if(e=t?o+1<n.length?Array.from(n)[o+1]:Array.from(n)[o]:o>0?Array.from(n)[o-1]:Array.from(n)[0],console.log(n[o],e),n[o].classList.contains("section--variants")){let n=document.querySelectorAll(".section--variants .variant");t&&n[n.length-1].classList.contains("variant--current")||!t&&n[0].classList.contains("variant--current")?new a(e,t,600):new function(e,t,n){s=!0;let a=e.querySelector(".section__variants").getBoundingClientRect().top,i=e.querySelector("ul"),o=e.querySelector(".variant--current"),c=n?Array.from(t).findIndex(e=>e.classList.contains("variant--current"))+1:Array.from(t).findIndex(e=>e.classList.contains("variant--current"))-1,r=Array.from(t)[c].getBoundingClientRect().top,l=0;if(i.style.transform){let e=window.getComputedStyle(i);l=new DOMMatrixReadOnly(e.transform).m42}console.log(a,i.getBoundingClientRect().top,r,l),o.classList.remove("variant--current"),Array.from(t)[c].classList.add("variant--current"),i.style.transform=`translateY(${a-r+l}px)`,setTimeout(()=>s=!1,300)}(document.querySelector(".section--variants"),n,t)}else if(n[o].classList.contains("section--world")){let i=document.querySelectorAll(".section--world .section__slide");t&&i[i.length-1].classList.contains("show")||!t&&i[0].classList.contains("show")?new a(e,t,600):new function(e,t,n){s=!0;let a=Array.from(t).findIndex(e=>e.classList.contains("show")),i=n?a+1:a-1;Array.from(t)[a].classList.remove("show"),Array.from(t)[i].classList.add("show"),e.setAttribute("data-slide",+i),setTimeout(()=>s=!1,300)}(n[o],i,t)}else if(n[o].classList.contains("section--roadmap")||e.classList.contains("section--roadmap")&&!t||e.classList.contains("section--opportunities")&&!t){let s=document.querySelector(".section--roadmap .expertise");s.classList.contains("animate-off")?t?(new i(n[o].querySelector(".section__content"),s,t,900),new a(s,t,900,"bottom"),s.classList.remove("animate-off")):(e.querySelector(".community").classList.remove("animate-fade"),new a(e.querySelector(".community"),t,900,"center")):s.classList.contains("animate-fade")?(s.classList.remove("animate-fade"),e.querySelector(".section__content").classList.add("animate-fade"),new a(s,t,900,"bottom")):t?(new a(e,t,600),s.classList.add("animate-fade")):(new a(n[o],t,600),s.classList.add("animate-off"),n[o].querySelector(".section__content").classList.remove("animate-fade"))}else if(n[o].classList.contains("section--opportunities")||e.classList.contains("section--opportunities")&&!t||e.classList.contains("section--backstory")&&!t){let s=document.querySelector(".section--opportunities .community");s.classList.contains("animate-off")?t?(s.classList.remove("animate-off"),new i(n[o].querySelector(".section__content"),s,t,900),new a(s,t,900,"center")):(e.querySelector(".place").classList.remove("animate-fade"),new a(e.querySelector(".place"),t,900,"center")):s.classList.contains("animate-fade")?(s.classList.remove("animate-fade"),e.querySelector(".section__content").classList.add("animate-fade"),new a(s,t,900,"center")):t?(new a(s,t,900,"center"),s.classList.add("animate-fade")):(new a(n[o],t,600),s.classList.add("animate-off"),n[o].querySelector(".section__content").classList.remove("animate-fade"))}else if(n[o].classList.contains("section--backstory")||e.classList.contains("section--backstory")&&!t||e.classList.contains("section--world")&&!t){let s=document.querySelector(".section--backstory .place");s.classList.contains("animate-off")?t?(s.classList.remove("animate-off"),new i(n[o].querySelector(".section__content"),s,t,900),new a(s,t,900,"center")):(n[o].classList.remove("animate-off"),new a(e,t,600)):s.classList.contains("animate-fade")?(s.classList.remove("animate-fade"),e.querySelector(".section__content").classList.add("animate-fade"),new a(s,t,900,"center")):t?(new a(s,t,900,"center"),s.classList.add("animate-fade")):(new a(n[o],t,600),s.classList.add("animate-off"),n[o].querySelector(".section__content").classList.remove("animate-fade"))}else new a(e,t,600)}}window.addEventListener("wheel",o,{passive:!1}),window.addEventListener("mousewheel",o,{passive:!1}),window.addEventListener("DOMMouseScroll",o,{passive:!1}),document.querySelectorAll("iframe").forEach(e=>{e.addEventListener("wheel",o,{passive:!1}),e.addEventListener("mousewheel",o,{passive:!1}),e.addEventListener("DOMMouseScroll",o,{passive:!1})}),new Splide(".splide",{perPage:3,perMove:1,gap:"32px",breakpoints:{820:{perPage:2},520:{perPage:1}}}).mount()};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMuanMiXSwibmFtZXMiOlsid2luZG93Iiwib25sb2FkIiwib2JzZXJ2ZXIiLCJJbnRlcnNlY3Rpb25PYnNlcnZlciIsImVudHJpZXMiLCJmb3JFYWNoIiwiZW50cnkiLCJpc0ludGVyc2VjdGluZyIsInRhcmdldCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCIsInJvb3QiLCJyb290TWFyZ2luIiwidGhyZXNob2xkIiwiUGFyYWxsYXgiLCJlIiwiX3ciLCJpbm5lcldpZHRoIiwiX2giLCJpbm5lckhlaWdodCIsIl9tb3VzZVgiLCJjbGllbnRYIiwiX21vdXNlWSIsImNsaWVudFkiLCJ0aGlzIiwicXVlcnlTZWxlY3RvckFsbCIsImVsIiwiaW5kZXgiLCJtdWx0aXBseSIsInN0eWxlIiwibWFyZ2luTGVmdCIsIm1hcmdpblRvcCIsImRvY3VtZW50Iiwib2JzZXJ2ZSIsInBhcmFsbGF4IiwiYWRkRXZlbnRMaXN0ZW5lciIsInNlY3Rpb25zIiwiaXNTY3JvbGxpbmciLCJTY3JvbGwiLCJlbGVtZW50IiwiaXNEb3duIiwic3BlZWQiLCJ0eXBlIiwic3RhcnQiLCJmaXJzdFBvcyIsInBhZ2VZT2Zmc2V0IiwiZG9jdW1lbnRFbGVtZW50Iiwic2Nyb2xsVG9wIiwid2luZG93SGVpZ2h0IiwicG9zIiwib2Zmc2V0SGVpZ2h0IiwicGFyZW50RWxlbWVudCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsImJvdHRvbSIsImNvbnNvbGUiLCJsb2ciLCJicm93c2VyIiwieCIsImxlbmd0aCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImNhbmNlbEFuaW1hdGlvbkZyYW1lIiwic2hvd0FuaW1hdGlvbiIsInRpbWVzdGFtcCIsIkRhdGUiLCJnZXRUaW1lIiwicHJvZ3Jlc3MiLCJ0b0ZpeGVkIiwiZWFzZUluUGVyY2VudGFnZSIsIm4iLCJzY3JvbGxUbyIsImlzTmFOIiwiYm9keSIsImNsaWVudEhlaWdodCIsImZvY3VzIiwiQW5pbWF0ZUZhZGUiLCJjdXJyZW50IiwiaWREb3duIiwidGltZSIsIldoZWVsIiwicHJldmVudERlZmF1bHQiLCJkZWx0YVkiLCJBcnJheSIsImZyb20iLCJmaW5kSW5kZXgiLCJzZWN0aW9uIiwiY29udGFpbnMiLCJ2YXJpYW50cyIsImNvbnRhaW5lciIsImVsZW1lbnRzIiwiY29udGFpbmVyVG9wIiwicXVlcnlTZWxlY3RvciIsInBhcmVudCIsInRhcmdldEluZGV4IiwidHJhbnNmb3JtIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsIkRPTU1hdHJpeFJlYWRPbmx5IiwibTQyIiwic2V0VGltZW91dCIsInNsaWRlcyIsInNldEF0dHJpYnV0ZSIsImV4cGVydGlzZSIsImNvbW11bml0eSIsInBsYWNlIiwicGFzc2l2ZSIsImlmcmFtZSIsIlNwbGlkZSIsInBlclBhZ2UiLCJwZXJNb3ZlIiwiZ2FwIiwiYnJlYWtwb2ludHMiLCI4MjAiLCI1MjAiLCJtb3VudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQUEsT0FBQUMsT0FBQSxXQWFBLE1BQUFDLEVBQUEsSUFBQUMscUJBTkEsU0FBQUMsRUFBQUYsR0FQQUUsRUFBQUMsUUFBQUMsSUFDQUEsRUFBQUMsZ0JBRUFELEVBQUFFLE9BQUFDLFVBQUFDLE9BQUEsZUFDQUosRUFBQUUsT0FBQUMsVUFBQUUsSUFBQSxhQUdBTCxFQUFBRSxPQUFBQyxVQUFBQyxPQUFBLFdBQ0FKLEVBQUFFLE9BQUFDLFVBQUFFLElBQUEsb0JBTkFDLEtBQUEsS0FDQUMsV0FBQSxPQUNBQyxVQUFBLEtBY0EsU0FBQUMsRUFBQUMsR0FDQSxJQUFBQyxFQUFBakIsT0FBQWtCLFdBQUEsRUFDQUMsRUFBQW5CLE9BQUFvQixZQUFBLEVBQ0FDLEVBQUFMLEVBQUFNLFFBQ0FDLEVBQUFQLEVBQUFRLFFBQ0FDLEtBQUFDLGlCQUFBLGVBQ0FyQixRQUFBLENBQUFzQixFQUFBQyxLQUNBLElBQUFDLEdBQUEsS0FBQUQsRUFBQSxLQUNBRCxFQUFBRyxNQUFBQyxlQUFBVixFQUFBSixHQUFBWSxLQUNBRixFQUFBRyxNQUFBRSxj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QixTQUFBLE1BZ0JBLElBQUFFLE9BQUEsV0FDQUMsUUFBQSxFQUNBQyxRQUFBLEVBQ0FDLElBQUEsT0FDQUMsYUFDQUMsS0FDQUosUUFBQSxHQUVBSyxLQUNBTCxRQUFBLE1BSUFNIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsid2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgY29uc3Qgb2JzZXJ2ZXJPcHRpb25zID0ge1xuICAgIHJvb3Q6IG51bGwsXG4gICAgcm9vdE1hcmdpbjogXCIyNHB4XCIsXG4gICAgdGhyZXNob2xkOiAwLjVcbiAgfTtcblxuICBmdW5jdGlvbiBvYnNlcnZlckNhbGxiYWNrKGVudHJpZXMsIG9ic2VydmVyKSB7XG4gICAgZW50cmllcy5mb3JFYWNoKGVudHJ5ID0+IHtcbiAgICAgIGlmIChlbnRyeS5pc0ludGVyc2VjdGluZykge1xuICAgICAgICAvLyBmYWRlIGluIG9ic2VydmVkIGVsZW1lbnRzIHRoYXQgYXJlIGluIHZpZXdcbiAgICAgICAgZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtb2ZmJyk7XG4gICAgICAgIGVudHJ5LnRhcmdldC5jbGFzc0xpc3QuYWRkKCdhbmltYXRlJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBmYWRlIG91dCBvYnNlcnZlZCBlbGVtZW50cyB0aGF0IGFyZSBub3QgaW4gdmlld1xuICAgICAgICBlbnRyeS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZScpO1xuICAgICAgICBlbnRyeS50YXJnZXQuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZS1vZmYnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKG9ic2VydmVyQ2FsbGJhY2ssIG9ic2VydmVyT3B0aW9ucyk7XG5cbiAgY29uc3QgZmFkZUVsbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdzZWN0aW9uJyk7XG4gIGZhZGVFbG1zLmZvckVhY2goZWwgPT4gb2JzZXJ2ZXIub2JzZXJ2ZShlbCkpO1xuXG4gIGZ1bmN0aW9uIFBhcmFsbGF4KGUpIHtcbiAgICBsZXQgX3cgPSB3aW5kb3cuaW5uZXJXaWR0aC8yO1xuICAgIGxldCBfaCA9IHdpbmRvdy5pbm5lckhlaWdodC8yO1xuICAgIGxldCBfbW91c2VYID0gZS5jbGllbnRYO1xuICAgIGxldCBfbW91c2VZID0gZS5jbGllbnRZO1xuICAgIGxldCBlbGVtcyA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgnLnBhcmFsbGF4ZWQnKTtcbiAgICBlbGVtcy5mb3JFYWNoKChlbCwgaW5kZXgpID0+IHtcbiAgICAgIGxldCBtdWx0aXBseSA9IGluZGV4ICogLTAuMDAxIC0gMC4wMDE7XG4gICAgICBlbC5zdHlsZS5tYXJnaW5MZWZ0ID0gYCR7KF9tb3VzZVggLSBfdykgKiBtdWx0aXBseX0lYDtcbiAgICAgIGVsLnN0eWxlLm1hcmdpblRvcCA9IGAkeyhfbW91c2VZIC0gX2gpICogbXVsdGlwbHl9JWA7XG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBwYXJhbGxheGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBhcmFsbGF4Jyk7XG4gIHBhcmFsbGF4ZXMuZm9yRWFjaCgocGFyYWxsYXgpID0+IHtcbiAgICBwYXJhbGxheC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIFBhcmFsbGF4KTtcbiAgfSk7XG5cbiAgY29uc3Qgc2VjdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VjdGlvbicpO1xuXG4gIC8vIHNlY3Rpb25zLmZvckVhY2goKHNlY3Rpb24pID0+IHtcbiAgLy8gICBjb25zb2xlLmxvZyhzZWN0aW9uLmNsYXNzTGlzdCk7XG4gIC8vIH0pO1xuICBsZXQgaXNTY3JvbGxpbmcgPSBmYWxzZTtcblxuICBmdW5jdGlvbiBTY3JvbGwoZWxlbWVudCwgaXNEb3duLCBzcGVlZCwgdHlwZSkge1xuICAgIGlzU2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICBsZXQgc3RhcnQgPSBudWxsO1xuICAgIGxldCBmaXJzdFBvcyA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgIGxldCB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgbGV0IHRhcmdldCA9IDA7XG4gICAgbGV0IHBvcyA9IDA7XG5cbiAgICBpZiAodHlwZSA9PT0gJ2NlbnRlcicpIHtcbiAgICAgIHRhcmdldCA9IGlzRG93biA/ICh3aW5kb3dIZWlnaHQgKyBlbGVtZW50Lm9mZnNldEhlaWdodCkgLyAyIDogZWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCArICh3aW5kb3dIZWlnaHQgKyBlbGVtZW50Lm9mZnNldEhlaWdodCkgLyAyO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2JvdHRvbScpIHtcbiAgICAgIHRhcmdldCA9IGVsZW1lbnQucGFyZW50RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5ib3R0b20gLSB3aW5kb3dIZWlnaHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcmdldCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGZpcnN0UG9zLCB0YXJnZXQsIHBvcywgZWxlbWVudCk7XG5cbiAgICAoZnVuY3Rpb24oKSB7XG5cbiAgICAgIGNvbnN0IGJyb3dzZXIgPSBbJ21zJywgJ21veicsICd3ZWJraXQnLCAnbyddO1xuXG4gICAgICBmb3IobGV0IHggPSAwLCBsZW5ndGggPSBicm93c2VyLmxlbmd0aDsgeCA8IGxlbmd0aCAmJiAhd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZTsgeCsrKSB7XG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB3aW5kb3dbYnJvd3Nlclt4XSsnUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107XG4gICAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSA9IHdpbmRvd1ticm93c2VyW3hdKydDYW5jZWxBbmltYXRpb25GcmFtZSddIHx8IHdpbmRvd1ticm93c2VyW3hdKydDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcbiAgICAgIH1cblxuICAgIH0oKSk7XG5cbiAgICBmdW5jdGlvbiBzaG93QW5pbWF0aW9uICh0aW1lc3RhbXApIHtcblxuICAgICAgaWYoIXN0YXJ0KSB7IHN0YXJ0ID0gdGltZXN0YW1wIHx8IG5ldyBEYXRlKCkuZ2V0VGltZSgpOyB9IC8vZ2V0IGlkIG9mIGFuaW1hdGlvblxuXG4gICAgICBsZXQgZWxhcHNlZCA9IHRpbWVzdGFtcCAtIHN0YXJ0O1xuICAgICAgbGV0IHByb2dyZXNzID0gZWxhcHNlZCAvICtzcGVlZDsgLy8gYW5pbWF0aW9uIGR1cmF0aW9uIDUwMG1zXG4gICAgICBwcm9ncmVzcyA9ICtwcm9ncmVzcy50b0ZpeGVkKDIpO1xuXG4gICAgICAvLyBjb25zb2xlLmxvZyhzdGFydCwgdGltZXN0YW1wLCBwcm9ncmVzcywgZWxhcHNlZCwgc3BlZWQsIGZpcnN0UG9zLCB0YXJnZXQsIHBvcyk7XG5cbiAgICAgIC8vZWFzZSBpbiBmdW5jdGlvbiBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9jb21wb25lbnQvZWFzZS9ibG9iL21hc3Rlci9pbmRleC5qc1xuICAgICAgY29uc3Qgb3V0UXVhZCA9IGZ1bmN0aW9uKG4pe1xuICAgICAgICByZXR1cm4gbiAqICgyIC0gbik7XG4gICAgICB9O1xuXG4gICAgICBsZXQgZWFzZUluUGVyY2VudGFnZSA9ICsob3V0UXVhZChwcm9ncmVzcykpLnRvRml4ZWQoMik7XG5cbiAgICAgIHBvcyA9IGZpcnN0UG9zICsgKHRhcmdldCAqIGVhc2VJblBlcmNlbnRhZ2UpO1xuICAgICAgcG9zID0gK3Bvcy50b0ZpeGVkKDIpO1xuICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHBvcyk7XG5cbiAgICAgIC8vIGNvbnNvbGUubG9nKGZpcnN0UG9zLCB0YXJnZXQsIHBvcywgZWFzZUluUGVyY2VudGFnZSk7XG5cbiAgICAgIGlmKCBpc05hTihwb3MpIHx8IHBvcyA8IDAgfHxcbiAgICAgICAgIWlzRG93biAmJiBwb3MgPD0gMCB8fFxuICAgICAgICAhaXNEb3duICYmIHBvcyA8PSAoZmlyc3RQb3MgKyB0YXJnZXQgKyAxKSB8fFxuICAgICAgICBpc0Rvd24gJiYgcG9zID49IChmaXJzdFBvcyArIHRhcmdldCkgfHxcbiAgICAgICAgaXNEb3duICYmIHBvcyA+PSBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCAtIHdpbmRvdy5pbm5lckhlaWdodCAtIDEgfHxcbiAgICAgICAgcG9zID4gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQgLSB3aW5kb3cuaW5uZXJIZWlnaHQgKSB7XG4gICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHN0YXJ0KTtcbiAgICAgICAgaWYoZWxlbWVudCkge1xuICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgICBwb3MgPSAwO1xuICAgICAgICBpc1Njcm9sbGluZyA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzaG93QW5pbWF0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzaG93QW5pbWF0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIElubmVyU2Nyb2xsKGNvbnRhaW5lciwgZWxlbWVudHMsIGlzRG93bikge1xuICAgIGlzU2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICBsZXQgY29udGFpbmVyVG9wID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uX192YXJpYW50cycpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICBsZXQgcGFyZW50ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3VsJyk7XG4gICAgbGV0IGN1cnJlbnQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLnZhcmlhbnQtLWN1cnJlbnQnKTtcbiAgICBsZXQgdGFyZ2V0SW5kZXggPSBpc0Rvd24gP1xuICAgICAgQXJyYXkuZnJvbShlbGVtZW50cykuZmluZEluZGV4KCBlbCA9PiBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3ZhcmlhbnQtLWN1cnJlbnQnKSkgKyAxIDpcbiAgICAgIEFycmF5LmZyb20oZWxlbWVudHMpLmZpbmRJbmRleCggZWwgPT4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCd2YXJpYW50LS1jdXJyZW50JykpIC0gMTtcbiAgICBsZXQgdGFyZ2V0ID0gQXJyYXkuZnJvbShlbGVtZW50cylbdGFyZ2V0SW5kZXhdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICBsZXQgcG9zID0gMDtcbiAgICBpZiAocGFyZW50LnN0eWxlLnRyYW5zZm9ybSkge1xuICAgICAgbGV0IHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50KTtcbiAgICAgIGxldCBtYXRyaXggPSBuZXcgRE9NTWF0cml4UmVhZE9ubHkoc3R5bGUudHJhbnNmb3JtKTtcbiAgICAgIHBvcyA9IG1hdHJpeC5tNDI7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGNvbnRhaW5lclRvcCwgcGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCwgdGFyZ2V0LCBwb3MpO1xuICAgIGN1cnJlbnQuY2xhc3NMaXN0LnJlbW92ZSgndmFyaWFudC0tY3VycmVudCcpO1xuICAgIEFycmF5LmZyb20oZWxlbWVudHMpW3RhcmdldEluZGV4XS5jbGFzc0xpc3QuYWRkKCd2YXJpYW50LS1jdXJyZW50Jyk7XG4gICAgcGFyZW50LnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGVZKCR7Y29udGFpbmVyVG9wIC0gdGFyZ2V0ICsgcG9zfXB4KWA7XG4gICAgc2V0VGltZW91dCgoKSA9PiBpc1Njcm9sbGluZyA9IGZhbHNlLCAzMDApO1xuICB9XG5cbiAgZnVuY3Rpb24gU2xpZGVzU2Nyb2xsKGNvbnRhaW5lciwgZWxlbWVudHMsIGlzRG93bikge1xuICAgIGlzU2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICBsZXQgY3VycmVudCA9IEFycmF5LmZyb20oZWxlbWVudHMpLmZpbmRJbmRleChlbCA9PiBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3cnKSk7XG4gICAgbGV0IHRhcmdldCA9IGlzRG93biA/IGN1cnJlbnQgKyAxIDogY3VycmVudCAtIDE7XG4gICAgQXJyYXkuZnJvbShlbGVtZW50cylbY3VycmVudF0uY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICAgIEFycmF5LmZyb20oZWxlbWVudHMpW3RhcmdldF0uY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2xpZGUnLCArdGFyZ2V0KTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IGlzU2Nyb2xsaW5nID0gZmFsc2UsIDMwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBBbmltYXRlRmFkZShjdXJyZW50LCB0YXJnZXQsIGlkRG93biwgdGltZSkge1xuICAgIGlmICghKCFpZERvd24gJiYgdGFyZ2V0Lm9mZnNldEhlaWdodCA8IHdpbmRvdy5pbm5lckhlaWdodCkpIHtcbiAgICAgIGN1cnJlbnQuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgICB0YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gV2hlZWwoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBsZXQgaXNEb3duID0gZS5kZWx0YVkgPiAwO1xuICAgIGlmICghaXNTY3JvbGxpbmcpIHtcbiAgICAgIGxldCBjdXJyZW50ID0gQXJyYXkuZnJvbShzZWN0aW9ucykuZmluZEluZGV4KHNlY3Rpb24gPT4gc2VjdGlvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2FuaW1hdGUnKSk7XG4gICAgICBsZXQgdGFyZ2V0O1xuICAgICAgaWYgKGlzRG93bikge1xuICAgICAgICB0YXJnZXQgPSBjdXJyZW50ICsgMSA8IHNlY3Rpb25zLmxlbmd0aCA/IEFycmF5LmZyb20oc2VjdGlvbnMpW2N1cnJlbnQgKyAxXSA6IEFycmF5LmZyb20oc2VjdGlvbnMpW2N1cnJlbnRdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGFyZ2V0ID0gY3VycmVudCA+IDAgPyBBcnJheS5mcm9tKHNlY3Rpb25zKVtjdXJyZW50IC0gMV0gOiBBcnJheS5mcm9tKHNlY3Rpb25zKVswXTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coc2VjdGlvbnNbY3VycmVudF0sIHRhcmdldCk7XG5cbiAgICAgIGlmIChzZWN0aW9uc1tjdXJyZW50XS5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLXZhcmlhbnRzJykpIHtcbiAgICAgICAgbGV0IHZhcmlhbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlY3Rpb24tLXZhcmlhbnRzIC52YXJpYW50Jyk7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBpc0Rvd24gJiYgdmFyaWFudHNbdmFyaWFudHMubGVuZ3RoIC0gMV0uY2xhc3NMaXN0LmNvbnRhaW5zKCd2YXJpYW50LS1jdXJyZW50JykgfHxcbiAgICAgICAgICAhaXNEb3duICYmIHZhcmlhbnRzWzBdLmNsYXNzTGlzdC5jb250YWlucygndmFyaWFudC0tY3VycmVudCcpXG4gICAgICAgICkge1xuICAgICAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LCBpc0Rvd24sIDYwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV3IElubmVyU2Nyb2xsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLS12YXJpYW50cycpLCB2YXJpYW50cywgaXNEb3duKTtcbiAgICAgICAgfVxuXG4gICAgICB9IGVsc2UgaWYgKHNlY3Rpb25zW2N1cnJlbnRdLmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0td29ybGQnKSkge1xuICAgICAgICBsZXQgc2xpZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlY3Rpb24tLXdvcmxkIC5zZWN0aW9uX19zbGlkZScpO1xuICAgICAgICBpZiAoaXNEb3duICYmIHNsaWRlc1tzbGlkZXMubGVuZ3RoIC0gMV0uY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93JykgfHxcbiAgICAgICAgICAhaXNEb3duICYmIHNsaWRlc1swXS5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3cnKSkge1xuICAgICAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LCBpc0Rvd24sIDYwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV3IFNsaWRlc1Njcm9sbChzZWN0aW9uc1tjdXJyZW50XSwgc2xpZGVzLCBpc0Rvd24pO1xuICAgICAgICB9XG5cbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIHNlY3Rpb25zW2N1cnJlbnRdLmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tcm9hZG1hcCcpIHx8XG4gICAgICAgIHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLXJvYWRtYXAnKSAmJiAhaXNEb3duIHx8XG4gICAgICAgIHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLW9wcG9ydHVuaXRpZXMnKSAmJiAhaXNEb3duXG4gICAgICApIHtcbiAgICAgICAgbGV0IGV4cGVydGlzZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLS1yb2FkbWFwIC5leHBlcnRpc2UnKTtcbiAgICAgICAgaWYgKGV4cGVydGlzZS5jbGFzc0xpc3QuY29udGFpbnMoJ2FuaW1hdGUtb2ZmJykpIHtcbiAgICAgICAgICBpZiAoaXNEb3duKSB7XG4gICAgICAgICAgICBuZXcgQW5pbWF0ZUZhZGUoc2VjdGlvbnNbY3VycmVudF0ucXVlcnlTZWxlY3RvcignLnNlY3Rpb25fX2NvbnRlbnQnKSwgZXhwZXJ0aXNlLCBpc0Rvd24sIDkwMCk7XG4gICAgICAgICAgICBuZXcgU2Nyb2xsKGV4cGVydGlzZSwgaXNEb3duLCA5MDAsICdib3R0b20nKTtcbiAgICAgICAgICAgIGV4cGVydGlzZS5jbGFzc0xpc3QucmVtb3ZlKCdhbmltYXRlLW9mZicpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0YXJnZXQucXVlcnlTZWxlY3RvcignLmNvbW11bml0eScpLmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtZmFkZScpO1xuICAgICAgICAgICAgbmV3IFNjcm9sbCh0YXJnZXQucXVlcnlTZWxlY3RvcignLmNvbW11bml0eScpLCBpc0Rvd24sIDkwMCwgJ2NlbnRlcicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChleHBlcnRpc2UuY2xhc3NMaXN0LmNvbnRhaW5zKCdhbmltYXRlLWZhZGUnKSkge1xuICAgICAgICAgIGV4cGVydGlzZS5jbGFzc0xpc3QucmVtb3ZlKCdhbmltYXRlLWZhZGUnKTtcbiAgICAgICAgICB0YXJnZXQucXVlcnlTZWxlY3RvcignLnNlY3Rpb25fX2NvbnRlbnQnKS5jbGFzc0xpc3QuYWRkKCdhbmltYXRlLWZhZGUnKTtcbiAgICAgICAgICBuZXcgU2Nyb2xsKGV4cGVydGlzZSwgaXNEb3duLCA5MDAsICdib3R0b20nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoaXNEb3duKSB7XG4gICAgICAgICAgICBuZXcgU2Nyb2xsKHRhcmdldCwgaXNEb3duLCA2MDApO1xuICAgICAgICAgICAgZXhwZXJ0aXNlLmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGUtZmFkZScpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuZXcgU2Nyb2xsKHNlY3Rpb25zW2N1cnJlbnRdLCBpc0Rvd24sIDYwMCk7XG4gICAgICAgICAgICBleHBlcnRpc2UuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZS1vZmYnKTtcbiAgICAgICAgICAgIHNlY3Rpb25zW2N1cnJlbnRdLnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uX19jb250ZW50JykuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIHNlY3Rpb25zW2N1cnJlbnRdLmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tb3Bwb3J0dW5pdGllcycpIHx8XG4gICAgICAgIHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLW9wcG9ydHVuaXRpZXMnKSAmJiAhaXNEb3duIHx8XG4gICAgICAgIHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLWJhY2tzdG9yeScpICYmICFpc0Rvd25cbiAgICAgICkge1xuICAgICAgICBsZXQgY29tbXVuaXR5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tLW9wcG9ydHVuaXRpZXMgLmNvbW11bml0eScpO1xuICAgICAgICBpZiAoY29tbXVuaXR5LmNsYXNzTGlzdC5jb250YWlucygnYW5pbWF0ZS1vZmYnKSkge1xuICAgICAgICAgIGlmIChpc0Rvd24pIHtcbiAgICAgICAgICAgIGNvbW11bml0eS5jbGFzc0xpc3QucmVtb3ZlKCdhbmltYXRlLW9mZicpO1xuICAgICAgICAgICAgbmV3IEFuaW1hdGVGYWRlKHNlY3Rpb25zW2N1cnJlbnRdLnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uX19jb250ZW50JyksIGNvbW11bml0eSwgaXNEb3duLCA5MDApO1xuICAgICAgICAgICAgbmV3IFNjcm9sbChjb21tdW5pdHksIGlzRG93biwgOTAwLCAnY2VudGVyJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhcmdldC5xdWVyeVNlbGVjdG9yKCcucGxhY2UnKS5jbGFzc0xpc3QucmVtb3ZlKCdhbmltYXRlLWZhZGUnKTtcbiAgICAgICAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5wbGFjZScpLCBpc0Rvd24sIDkwMCwgJ2NlbnRlcicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChjb21tdW5pdHkuY2xhc3NMaXN0LmNvbnRhaW5zKCdhbmltYXRlLWZhZGUnKSkge1xuICAgICAgICAgIGNvbW11bml0eS5jbGFzc0xpc3QucmVtb3ZlKCdhbmltYXRlLWZhZGUnKTtcbiAgICAgICAgICB0YXJnZXQucXVlcnlTZWxlY3RvcignLnNlY3Rpb25fX2NvbnRlbnQnKS5jbGFzc0xpc3QuYWRkKCdhbmltYXRlLWZhZGUnKTtcbiAgICAgICAgICBuZXcgU2Nyb2xsKGNvbW11bml0eSwgaXNEb3duLCA5MDAsICdjZW50ZXInKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoaXNEb3duKSB7XG4gICAgICAgICAgICBuZXcgU2Nyb2xsKGNvbW11bml0eSwgaXNEb3duLCA5MDAsICdjZW50ZXInKTtcbiAgICAgICAgICAgIGNvbW11bml0eS5jbGFzc0xpc3QuYWRkKCdhbmltYXRlLWZhZGUnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3IFNjcm9sbChzZWN0aW9uc1tjdXJyZW50XSwgaXNEb3duLCA2MDApO1xuICAgICAgICAgICAgY29tbXVuaXR5LmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGUtb2ZmJyk7XG4gICAgICAgICAgICBzZWN0aW9uc1tjdXJyZW50XS5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbl9fY29udGVudCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtZmFkZScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICBzZWN0aW9uc1tjdXJyZW50XS5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLWJhY2tzdG9yeScpIHx8XG4gICAgICAgIHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLWJhY2tzdG9yeScpICYmICFpc0Rvd24gfHxcbiAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0td29ybGQnKSAmJiAhaXNEb3duXG4gICAgICApIHtcbiAgICAgICAgbGV0IHBsYWNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tLWJhY2tzdG9yeSAucGxhY2UnKTtcbiAgICAgICAgaWYgKHBsYWNlLmNsYXNzTGlzdC5jb250YWlucygnYW5pbWF0ZS1vZmYnKSkge1xuICAgICAgICAgIGlmIChpc0Rvd24pIHtcbiAgICAgICAgICAgIHBsYWNlLmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtb2ZmJyk7XG4gICAgICAgICAgICBuZXcgQW5pbWF0ZUZhZGUoc2VjdGlvbnNbY3VycmVudF0ucXVlcnlTZWxlY3RvcignLnNlY3Rpb25fX2NvbnRlbnQnKSwgcGxhY2UsIGlzRG93biwgOTAwKTtcbiAgICAgICAgICAgIG5ldyBTY3JvbGwocGxhY2UsIGlzRG93biwgOTAwLCAnY2VudGVyJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNlY3Rpb25zW2N1cnJlbnRdLmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtb2ZmJyk7XG4gICAgICAgICAgICBuZXcgU2Nyb2xsKHRhcmdldCwgaXNEb3duLCA2MDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChwbGFjZS5jbGFzc0xpc3QuY29udGFpbnMoJ2FuaW1hdGUtZmFkZScpKSB7XG4gICAgICAgICAgcGxhY2UuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgICAgICAgdGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uX19jb250ZW50JykuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgICAgICAgbmV3IFNjcm9sbChwbGFjZSwgaXNEb3duLCA5MDAsICdjZW50ZXInKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoaXNEb3duKSB7XG4gICAgICAgICAgICBuZXcgU2Nyb2xsKHBsYWNlLCBpc0Rvd24sIDkwMCwgJ2NlbnRlcicpO1xuICAgICAgICAgICAgcGxhY2UuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ldyBTY3JvbGwoc2VjdGlvbnNbY3VycmVudF0sIGlzRG93biwgNjAwKTtcbiAgICAgICAgICAgIHBsYWNlLmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGUtb2ZmJyk7XG4gICAgICAgICAgICBzZWN0aW9uc1tjdXJyZW50XS5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbl9fY29udGVudCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtZmFkZScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXcgU2Nyb2xsKHRhcmdldCwgaXNEb3duLCA2MDApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIFdoZWVsLCB7cGFzc2l2ZTogZmFsc2V9KTtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNld2hlZWwnLCBXaGVlbCwge3Bhc3NpdmU6IGZhbHNlfSk7XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Nb3VzZVNjcm9sbCcsIFdoZWVsLCB7cGFzc2l2ZTogZmFsc2V9KTtcblxuICBsZXQgaWZyYW1lcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lmcmFtZScpO1xuICBpZnJhbWVzLmZvckVhY2goKGlmcmFtZSkgPT4ge1xuICAgIGlmcmFtZS5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIFdoZWVsLCB7cGFzc2l2ZTogZmFsc2V9KTtcbiAgICBpZnJhbWUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V3aGVlbCcsIFdoZWVsLCB7cGFzc2l2ZTogZmFsc2V9KTtcbiAgICBpZnJhbWUuYWRkRXZlbnRMaXN0ZW5lcignRE9NTW91c2VTY3JvbGwnLCBXaGVlbCwge3Bhc3NpdmU6IGZhbHNlfSk7XG4gIH0pO1xuXG4gIC8vIGRvY3VtZW50Lm9ua2V5dXAgPSBmdW5jdGlvbihlKXtcbiAgLy8gICBjb25zb2xlLmxvZygnS2V5IDogJyArIGUuY29kZSk7XG4gIC8vICAgbGV0IGN1cnJlbnQgPSBBcnJheS5mcm9tKHNlY3Rpb25zKS5maW5kSW5kZXgoIHNlY3Rpb24gPT4gc2VjdGlvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2FuaW1hdGUnKSApO1xuICAvLyAgIGxldCB0YXJnZXQ7XG4gIC8vICAgaWYgKGUuY29kZSA9PT0gKCdTcGFjZScgfHwgJ0Fycm93RG93bicgfHwgJ1BhZ2VEb3duJyB8fCAnRG93bicpKSB7XG4gIC8vICAgICB0YXJnZXQgPSBjdXJyZW50ICsgMSA8IHNlY3Rpb25zLmxlbmd0aCA/IEFycmF5LmZyb20oc2VjdGlvbnMpW2N1cnJlbnQgKyAxXSA6IEFycmF5LmZyb20oc2VjdGlvbnMpW2N1cnJlbnRdO1xuICAvLyAgICAgbmV3IFNjcm9sbCh0YXJnZXQsIHRydWUpO1xuICAvLyAgIH0gZWxzZSBpZiAoZS5jb2RlID09PSAoJ0Fycm93VXAnIHx8ICdQYWdlVXAnIHx8ICdVcCcpKSB7XG4gIC8vICAgICB0YXJnZXQgPSBjdXJyZW50ID4gMCA/IEFycmF5LmZyb20oc2VjdGlvbnMpW2N1cnJlbnQgLSAxXSA6IEFycmF5LmZyb20oc2VjdGlvbnMpWzBdO1xuICAvLyAgICAgbmV3IFNjcm9sbCh0YXJnZXQsIGZhbHNlKTtcbiAgLy8gICB9XG4gIC8vIH07XG5cbiAgbGV0IHNwbGlkZSA9IG5ldyBTcGxpZGUoICcuc3BsaWRlJywge1xuICAgIHBlclBhZ2U6IDMsXG4gICAgcGVyTW92ZTogMSxcbiAgICBnYXAgICAgOiAnMzJweCcsXG4gICAgYnJlYWtwb2ludHM6IHtcbiAgICAgIDgyMDoge1xuICAgICAgICBwZXJQYWdlOiAyXG4gICAgICB9LFxuICAgICAgNTIwOiB7XG4gICAgICAgIHBlclBhZ2U6IDFcbiAgICAgIH0sXG4gICAgfSxcbiAgfSApO1xuICBzcGxpZGUubW91bnQoKTtcbn07XG5cbiJdfQ==
