/*!
 * gulp-nunjucks-sass-template
 * A Gulp 4 template including SCSS, Nunjucks, JS and more
 *
 * Url: https://github.com/DefaultSimon
 * Author: Simon GoriÄar
 * Copyright 2022. License: MIT
 */
window.onload=function(){const e=new IntersectionObserver(function(e,t){e.forEach(e=>{e.isIntersecting?(e.target.classList.remove("animate-off"),e.target.classList.add("animate")):(e.target.classList.remove("animate"),e.target.classList.add("animate-off"))})},{root:null,rootMargin:"24px",threshold:.5});document.querySelectorAll("section").forEach(t=>e.observe(t)),document.querySelector(".section--top").addEventListener("mousemove",function(e){let t=window.innerWidth/2,n=window.innerHeight/2,o=e.clientX,i=e.clientY;this.querySelectorAll(".parallaxed").forEach((e,a)=>{let s=-.001*a-.001;e.style.marginLeft=`${(o-t)*s}%`,e.style.marginTop=`${(i-n)*s}%`})});const t=document.querySelectorAll(".section");function n(e,t){let n=null,o=window.pageYOffset||document.documentElement.scrollTop,i=e.getBoundingClientRect().top,a=0;console.log(o,i,a),function(){const e=["ms","moz","webkit","o"];for(let t=0,n=e.length;t<n&&!window.requestAnimationFrame;t++)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"]}(),window.requestAnimationFrame(function s(r){n||(n=r||(new Date).getTime());let c=(r-n)/600;c=+c.toFixed(2);let l=+(d=c,d*(2-d)).toFixed(2);var d;a=+(a=o+i*l).toFixed(2),window.scrollTo(0,a),console.log(o,i,a,l,document.body.clientHeight-window.innerHeight),a<0||!t&&a<=0||!t&&a<=o+i+1||t&&a>=o+i||t&&a>=document.body.clientHeight-window.innerHeight-1||a>document.body.clientHeight-window.innerHeight?(cancelAnimationFrame(n),e&&e.focus(),a=0):window.requestAnimationFrame(s)})}function o(e,t,n){let o=null,i=window.pageYOffset||document.documentElement.scrollTop,a=window.innerHeight,s=n?(a+t.offsetHeight)/2:e.getBoundingClientRect().top,r=0;console.log(i,a,t.offsetHeight,t.getBoundingClientRect().top,s,r),t.classList.add("animate"),function(){const e=["ms","moz","webkit","o"];for(let t=0,n=e.length;t<n&&!window.requestAnimationFrame;t++)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"]}(),window.requestAnimationFrame(function e(a){o||(o=a||(new Date).getTime());let c=(a-o)/900;c=+c.toFixed(2);let l=+(d=c,d*(2-d)).toFixed(2);var d;r=+(r=i+s*l).toFixed(2),window.scrollTo(0,r),console.log(i,s,r,l,document.body.clientHeight-window.innerHeight),r<0||!n&&r<=0||!n&&r<=i+s+1||n&&r>=i+s||n&&r>=document.body.clientHeight-window.innerHeight-1||r>document.body.clientHeight-window.innerHeight?(cancelAnimationFrame(o),t&&t.focus(),r=0):window.requestAnimationFrame(e)})}function i(e){e.preventDefault();let i,a=Array.from(t).findIndex(e=>e.classList.contains("animate"));if(i=e.deltaY>0?a+1<t.length?Array.from(t)[a+1]:Array.from(t)[a]:a>0?Array.from(t)[a-1]:Array.from(t)[0],t[a].classList.contains("section--variants")){let t=document.querySelectorAll(".section--variants .variant");e.deltaY>0&&t[t.length-1].classList.contains("variant--current")||e.deltaY<0&&t[0].classList.contains("variant--current")?new n(i,e.deltaY>0):new function(e,t,n){let o=e.querySelector(".section__variants").getBoundingClientRect().top,i=e.querySelector("ul"),a=e.querySelector(".variant--current"),s=n?Array.from(t).findIndex(e=>e.classList.contains("variant--current"))+1:Array.from(t).findIndex(e=>e.classList.contains("variant--current"))-1,r=Array.from(t)[s].getBoundingClientRect().top,c=0;if(i.style.transform){let e=window.getComputedStyle(i);c=new DOMMatrixReadOnly(e.transform).m42}console.log(o,i.getBoundingClientRect().top,r,c),a.classList.remove("variant--current"),Array.from(t)[s].classList.add("variant--current"),i.style.transform=`translateY(${o-r+c}px)`}(document.querySelector(".section--variants"),t,e.deltaY>0)}else if(t[a].classList.contains("section--world")){let t=document.querySelectorAll(".section--world .section__slide");e.deltaY>0&&t[t.length-1].classList.contains("show")||e.deltaY<0&&t[0].classList.contains("show")?new n(i,e.deltaY>0):new function(e,t){let n=Array.from(e).findIndex(e=>e.classList.contains("show")),o=t?n+1:n-1;Array.from(e)[n].classList.remove("show"),Array.from(e)[o].classList.add("show")}(t,e.deltaY>0)}else if(t[a].classList.contains("section--backstory")&&e.deltaY>0||i.classList.contains("section--backstory")&&e.deltaY<0||document.querySelector(".animate").classList.contains("place")){let s=document.querySelector(".section--backstory .place");if(t[a].classList.contains("section--backstory"))new o(document.querySelector(".section--backstory"),s,e.deltaY>0);else{let o=e.deltaY>0?Array.from(t).findIndex(e=>e.classList.contains("section--opportunities")):Array.from(t).findIndex(e=>e.classList.contains("section--backstory"));new n(i=Array.from(t)[o],e.deltaY>0),s.classList.remove("animate")}}else if(t[a].classList.contains("section--opportunities")&&e.deltaY>0||i.classList.contains("section--opportunities")&&e.deltaY<0||document.querySelector(".animate").classList.contains("community")){let s=document.querySelector(".section--opportunities .community");if(t[a].classList.contains("section--opportunities"))new o(document.querySelector(".section--opportunities"),s,e.deltaY>0);else{let o=e.deltaY>0?Array.from(t).findIndex(e=>e.classList.contains("section--roadmap")):Array.from(t).findIndex(e=>e.classList.contains("section--opportunities"));new n(i=Array.from(t)[o],e.deltaY>0),s.classList.remove("animate")}}else if(t[a].classList.contains("section--roadmap")&&e.deltaY>0||i.classList.contains("section--roadmap")&&e.deltaY<0||document.querySelector(".animate").classList.contains("expertise")){let o=document.querySelector(".section--roadmap .expertise");if(t[a].classList.contains("section--roadmap"))new function(e,t,n){let o=null,i=window.pageYOffset||document.documentElement.scrollTop,a=window.innerHeight,s=n?e.offsetHeight-a:t.getBoundingClientRect().bottom-a,r=0;console.log(i,t.offsetHeight,t.getBoundingClientRect().bottom,s,r),t.classList.add("animate"),function(){const e=["ms","moz","webkit","o"];for(let t=0,n=e.length;t<n&&!window.requestAnimationFrame;t++)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"]}(),window.requestAnimationFrame(function e(a){o||(o=a||(new Date).getTime());let c=(a-o)/900;c=+c.toFixed(2);let l=+(d=c,d*(2-d)).toFixed(2);var d;r=+(r=i+s*l).toFixed(2),window.scrollTo(0,r),console.log(i,s,r,l,document.body.clientHeight-window.innerHeight),r<0||!n&&r<=0||!n&&r<=i+s+1||n&&r>=i+s||n&&r>=document.body.clientHeight-window.innerHeight-1||r>document.body.clientHeight-window.innerHeight?(cancelAnimationFrame(o),t&&t.focus(),r=0):window.requestAnimationFrame(e)})}(document.querySelector(".section--roadmap"),o,e.deltaY>0);else{let a=e.deltaY>0?Array.from(t).findIndex(e=>e.classList.contains("section--partners")):Array.from(t).findIndex(e=>e.classList.contains("section--roadmap"));new n(i=Array.from(t)[a],e.deltaY>0),o.classList.remove("animate")}}else new n(i,e.deltaY>0)}window.addEventListener("wheel",i,{passive:!1}),window.addEventListener("mousewheel",i,{passive:!1}),window.addEventListener("DOMMouseScroll",i,{passive:!1}),document.onkeyup=function(e){console.log("Key : "+e.code);let o,i=Array.from(t).findIndex(e=>e.classList.contains("animate"));"Space"===e.code?new n(o=i+1<t.length?Array.from(t)[i+1]:Array.from(t)[i],!0):"ArrowUp"===e.code&&new n(o=i>0?Array.from(t)[i-1]:Array.from(t)[0],!1)},new Splide(".splide",{perPage:3,perMove:1,gap:"32px",breakpoints:{820:{perPage:2},520:{perPage:1}}}).mount()};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMuanMiXSwibmFtZXMiOlsid2luZG93Iiwib25sb2FkIiwib2JzZXJ2ZXIiLCJJbnRlcnNlY3Rpb25PYnNlcnZlciIsImVudHJpZXMiLCJmb3JFYWNoIiwiZW50cnkiLCJpc0ludGVyc2VjdGluZyIsInRhcmdldCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCIsInJvb3QiLCJyb290TWFyZ2luIiwidGhyZXNob2xkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZWwiLCJvYnNlcnZlIiwicXVlcnlTZWxlY3RvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiX3ciLCJpbm5lcldpZHRoIiwiX2giLCJpbm5lckhlaWdodCIsIl9tb3VzZVgiLCJjbGllbnRYIiwiX21vdXNlWSIsImNsaWVudFkiLCJ0aGlzIiwiaW5kZXgiLCJtdWx0aXBseSIsInN0eWxlIiwibWFyZ2luTGVmdCIsIm1hcmdpblRvcCIsInNlY3Rpb25zIiwiU2Nyb2xsIiwiZWxlbWVudCIsImlzRG93biIsInN0YXJ0IiwiZmlyc3RQb3MiLCJwYWdlWU9mZnNldCIsImRvY3VtZW50RWxlbWVudCIsInNjcm9sbFRvcCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsInBvcyIsImNvbnNvbGUiLCJsb2ciLCJicm93c2VyIiwieCIsImxlbmd0aCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImNhbmNlbEFuaW1hdGlvbkZyYW1lIiwic2hvd0FuaW1hdGlvbiIsInRpbWVzdGFtcCIsIkRhdGUiLCJnZXRUaW1lIiwicHJvZ3Jlc3MiLCJ0b0ZpeGVkIiwiZWFzZUluUGVyY2VudGFnZSIsIm4iLCJzY3JvbGxUbyIsImJvZHkiLCJjbGllbnRIZWlnaHQiLCJmb2N1cyIsIlNjcm9sbFRvQ2VudGVyIiwiY29udGFpbmVyIiwid2luZG93SGVpZ2h0Iiwib2Zmc2V0SGVpZ2h0IiwiV2hlZWwiLCJwcmV2ZW50RGVmYXVsdCIsImN1cnJlbnQiLCJBcnJheSIsImZyb20iLCJmaW5kSW5kZXgiLCJzZWN0aW9uIiwiY29udGFpbnMiLCJkZWx0YVkiLCJ2YXJpYW50cyIsImVsZW1lbnRzIiwiY29udGFpbmVyVG9wIiwicGFyZW50IiwidGFyZ2V0SW5kZXgiLCJ0cmFuc2Zvcm0iLCJnZXRDb21wdXRlZFN0eWxlIiwiRE9NTWF0cml4UmVhZE9ubHkiLCJtNDIiLCJzbGlkZXMiLCJwbGFjZSIsImNvbW11bml0eSIsImV4cGVydGlzZSIsImJvdHRvbSIsInBhc3NpdmUiLCJvbmtleXVwIiwiY29kZSIsIlNwbGlkZSIsInBlclBhZ2UiLCJwZXJNb3ZlIiwiZ2FwIiwiYnJlYWtwb2ludHMiLCI4MjAiLCI1MjAiLCJtb3VudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQUEsT0FBQUMsT0FBQSxXQWFBLE1BQUFDLEVBQUEsSUFBQUMscUJBTkEsU0FBQUMsRUFBQUYsR0FQQUUsRUFBQUMsUUFBQUMsSUFDQUEsRUFBQUMsZ0JBRUFELEVBQUFFLE9BQUFDLFVBQUFDLE9BQUEsZUFDQUosRUFBQUUsT0FBQUMsVUFBQUUsSUFBQSxhQUdBTCxFQUFBRSxPQUFBQyxVQUFBQyxPQUFBLFdBQ0FKLEVBQUFFLE9BQUFDLFVBQUFFLElBQUEsb0JBTkFDLEtBQUEsS0FDQUMsV0FBQSxPQUNBQyxVQUFBLEtBV0FDLFNBQUFDLGlCQUFBLFdBQ0FYLFFBQUFZLEdBQUFmLEVBQUFnQixRQUFBRCxJQWVBRixTQUFBSSxjQUFBLGlCQUNBQyxpQkFBQSxZQWRBLFNBQUFDLEdBQ0EsSUFBQUMsRUFBQXRCLE9BQUF1QixXQUFBLEVBQ0FDLEVBQUF4QixPQUFBeUIsWUFBQSxFQUNBQyxFQUFBTCxFQUFBTSxRQUNBQyxFQUFBUCxFQUFBUSxRQUNBQyxLQUFBZCxpQkFBQSxlQUNBWCxRQUFBLENBQUFZLEVBQUFjLEtBQ0EsSUFBQUMsR0FBQSxLQUFBRCxFQUFBLEtBQ0FkLEVBQUFnQixNQUFBQyxlQUFBUixFQUFBSixHQUFBVSxLQUNBZixFQUFBZ0IsTUFBQUUsY0FBQVAsRUFBQUosR0FBQVEsU0FPQSxNQUFBSSxFQUFBckIs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U0FBQSxJQUNBOUYsT0FBQW9CLGlCQUFBLGFBQUFtRCxHQUFBdUIsU0FBQSxJQUNBOUYsT0FBQW9CLGlCQUFBLGlCQUFBbUQsR0FBQXVCLFNBQUEsSUFFQS9FLFNBQUFnRixRQUFBLFNBQUExRSxHQUNBMkIsUUFBQUMsSUFBQSxTQUFBNUIsRUFBQTJFLE1BQ0EsSUFDQXhGLEVBREFpRSxFQUFBQyxNQUFBQyxLQUFBdkMsR0FBQXdDLFVBQUFDLEdBQUFBLEVBQUFwRSxVQUFBcUUsU0FBQSxZQUVBLFVBQUF6RCxFQUFBMkUsS0FFQSxJQUFBM0QsRUFEQTdCLEVBQUFpRSxFQUFBLEVBQUFyQyxFQUFBZ0IsT0FBQXNCLE1BQUFDLEtBQUF2QyxHQUFBcUMsRUFBQSxHQUFBQyxNQUFBQyxLQUFBdkMsR0FBQXFDLElBQ0EsR0FDQSxZQUFBcEQsRUFBQTJFLE1BRUEsSUFBQTNELEVBREE3QixFQUFBaUUsRUFBQSxFQUFBQyxNQUFBQyxLQUFBdkMsR0FBQXFDLEVBQUEsR0FBQUMsTUFBQUMsS0FBQXZDLEdBQUEsSUFDQSxJQUlBLElBQUE2RCxPQUFBLFdBQ0FDLFFBQUEsRUFDQUMsUUFBQSxFQUNBQyxJQUFBLE9BQ0FDLGFBQ0FDLEtBQ0FKLFFBQUEsR0FFQUssS0FDQUwsUUFBQSxNQUtBTSIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IG9ic2VydmVyT3B0aW9ucyA9IHtcbiAgICByb290OiBudWxsLFxuICAgIHJvb3RNYXJnaW46IFwiMjRweFwiLFxuICAgIHRocmVzaG9sZDogMC41XG4gIH07XG5cbiAgZnVuY3Rpb24gb2JzZXJ2ZXJDYWxsYmFjayhlbnRyaWVzLCBvYnNlcnZlcikge1xuICAgIGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7XG4gICAgICBpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcbiAgICAgICAgLy8gZmFkZSBpbiBvYnNlcnZlZCBlbGVtZW50cyB0aGF0IGFyZSBpbiB2aWV3XG4gICAgICAgIGVudHJ5LnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdhbmltYXRlLW9mZicpO1xuICAgICAgICBlbnRyeS50YXJnZXQuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZmFkZSBvdXQgb2JzZXJ2ZWQgZWxlbWVudHMgdGhhdCBhcmUgbm90IGluIHZpZXdcbiAgICAgICAgZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUnKTtcbiAgICAgICAgZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGUtb2ZmJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihvYnNlcnZlckNhbGxiYWNrLCBvYnNlcnZlck9wdGlvbnMpO1xuXG4gIGNvbnN0IGZhZGVFbG1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnc2VjdGlvbicpO1xuICBmYWRlRWxtcy5mb3JFYWNoKGVsID0+IG9ic2VydmVyLm9ic2VydmUoZWwpKTtcblxuICBmdW5jdGlvbiBwYXJhbGxheChlKSB7XG4gICAgbGV0IF93ID0gd2luZG93LmlubmVyV2lkdGgvMjtcbiAgICBsZXQgX2ggPSB3aW5kb3cuaW5uZXJIZWlnaHQvMjtcbiAgICBsZXQgX21vdXNlWCA9IGUuY2xpZW50WDtcbiAgICBsZXQgX21vdXNlWSA9IGUuY2xpZW50WTtcbiAgICBsZXQgZWxlbXMgPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJy5wYXJhbGxheGVkJyk7XG4gICAgZWxlbXMuZm9yRWFjaCgoZWwsIGluZGV4KSA9PiB7XG4gICAgICBsZXQgbXVsdGlwbHkgPSBpbmRleCAqIC0wLjAwMSAtIDAuMDAxO1xuICAgICAgZWwuc3R5bGUubWFyZ2luTGVmdCA9IGAkeyhfbW91c2VYIC0gX3cpICogbXVsdGlwbHl9JWA7XG4gICAgICBlbC5zdHlsZS5tYXJnaW5Ub3AgPSBgJHsoX21vdXNlWSAtIF9oKSAqIG11bHRpcGx5fSVgO1xuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgdG9wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tLXRvcCcpO1xuICB0b3AuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBwYXJhbGxheCk7XG5cbiAgY29uc3Qgc2VjdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VjdGlvbicpO1xuXG4gIC8vIHNlY3Rpb25zLmZvckVhY2goKHNlY3Rpb24pID0+IHtcbiAgLy8gICBjb25zb2xlLmxvZyhzZWN0aW9uLmNsYXNzTGlzdCk7XG4gIC8vIH0pO1xuICBmdW5jdGlvbiBTY3JvbGwoZWxlbWVudCwgaXNEb3duKSB7XG4gICAgbGV0IHN0YXJ0ID0gbnVsbDtcbiAgICBsZXQgZmlyc3RQb3MgPSB3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcbiAgICBsZXQgdGFyZ2V0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XG4gICAgbGV0IHBvcyA9IDA7XG5cbiAgICBjb25zb2xlLmxvZyhmaXJzdFBvcywgdGFyZ2V0LCBwb3MpO1xuXG4gICAgKGZ1bmN0aW9uKCkge1xuXG4gICAgICBjb25zdCBicm93c2VyID0gWydtcycsICdtb3onLCAnd2Via2l0JywgJ28nXTtcblxuICAgICAgZm9yKGxldCB4ID0gMCwgbGVuZ3RoID0gYnJvd3Nlci5sZW5ndGg7IHggPCBsZW5ndGggJiYgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWU7IHgrKykge1xuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gd2luZG93W2Jyb3dzZXJbeF0rJ1JlcXVlc3RBbmltYXRpb25GcmFtZSddO1xuICAgICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSB3aW5kb3dbYnJvd3Nlclt4XSsnQ2FuY2VsQW5pbWF0aW9uRnJhbWUnXSB8fCB3aW5kb3dbYnJvd3Nlclt4XSsnQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107XG4gICAgICB9XG5cbiAgICB9KCkpO1xuXG4gICAgZnVuY3Rpb24gc2hvd0FuaW1hdGlvbiAodGltZXN0YW1wKSB7XG5cbiAgICAgIGlmKCFzdGFydCkgeyBzdGFydCA9IHRpbWVzdGFtcCB8fCBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgfSAvL2dldCBpZCBvZiBhbmltYXRpb25cblxuICAgICAgbGV0IGVsYXBzZWQgPSB0aW1lc3RhbXAgLSBzdGFydDtcbiAgICAgIGxldCBwcm9ncmVzcyA9IGVsYXBzZWQgLyA2MDA7IC8vIGFuaW1hdGlvbiBkdXJhdGlvbiA1MDBtc1xuICAgICAgcHJvZ3Jlc3MgPSArcHJvZ3Jlc3MudG9GaXhlZCgyKTtcblxuICAgICAgLy9lYXNlIGluIGZ1bmN0aW9uIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2NvbXBvbmVudC9lYXNlL2Jsb2IvbWFzdGVyL2luZGV4LmpzXG4gICAgICBjb25zdCBvdXRRdWFkID0gZnVuY3Rpb24obil7XG4gICAgICAgIHJldHVybiBuICogKDIgLSBuKTtcbiAgICAgIH07XG5cbiAgICAgIGxldCBlYXNlSW5QZXJjZW50YWdlID0gKyhvdXRRdWFkKHByb2dyZXNzKSkudG9GaXhlZCgyKTtcblxuICAgICAgcG9zID0gZmlyc3RQb3MgKyAodGFyZ2V0ICogZWFzZUluUGVyY2VudGFnZSk7XG4gICAgICBwb3MgPSArcG9zLnRvRml4ZWQoMik7XG4gICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgcG9zKTtcblxuICAgICAgY29uc29sZS5sb2coZmlyc3RQb3MsIHRhcmdldCwgcG9zLCBlYXNlSW5QZXJjZW50YWdlLCBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCAtIHdpbmRvdy5pbm5lckhlaWdodCk7XG5cbiAgICAgIGlmKCBwb3MgPCAwIHx8XG4gICAgICAgICFpc0Rvd24gJiYgcG9zIDw9IDAgfHxcbiAgICAgICAgIWlzRG93biAmJiBwb3MgPD0gKGZpcnN0UG9zICsgdGFyZ2V0ICsgMSkgfHxcbiAgICAgICAgaXNEb3duICYmIHBvcyA+PSAoZmlyc3RQb3MgKyB0YXJnZXQpIHx8XG4gICAgICAgIGlzRG93biAmJiBwb3MgPj0gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQgLSB3aW5kb3cuaW5uZXJIZWlnaHQgLSAxIHx8XG4gICAgICAgIHBvcyA+IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0IC0gd2luZG93LmlubmVySGVpZ2h0ICkge1xuICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZShzdGFydCk7XG4gICAgICAgIGlmKGVsZW1lbnQpIHtcbiAgICAgICAgICBlbGVtZW50LmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgcG9zID0gMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc2hvd0FuaW1hdGlvbik7XG4gICAgICB9XG4gICAgfVxuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc2hvd0FuaW1hdGlvbik7XG4gIH1cblxuICBmdW5jdGlvbiBJbm5lclNjcm9sbChjb250YWluZXIsIGVsZW1lbnRzLCBpc0Rvd24pIHtcbiAgICBsZXQgY29udGFpbmVyVG9wID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uX192YXJpYW50cycpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICBsZXQgcGFyZW50ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3VsJyk7XG4gICAgbGV0IGN1cnJlbnQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLnZhcmlhbnQtLWN1cnJlbnQnKTtcbiAgICBsZXQgdGFyZ2V0SW5kZXggPSBpc0Rvd24gP1xuICAgICAgQXJyYXkuZnJvbShlbGVtZW50cykuZmluZEluZGV4KCBlbCA9PiBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3ZhcmlhbnQtLWN1cnJlbnQnKSkgKyAxIDpcbiAgICAgIEFycmF5LmZyb20oZWxlbWVudHMpLmZpbmRJbmRleCggZWwgPT4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCd2YXJpYW50LS1jdXJyZW50JykpIC0gMTtcbiAgICBsZXQgdGFyZ2V0ID0gQXJyYXkuZnJvbShlbGVtZW50cylbdGFyZ2V0SW5kZXhdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICBsZXQgcG9zID0gMDtcbiAgICBpZiAocGFyZW50LnN0eWxlLnRyYW5zZm9ybSkge1xuICAgICAgbGV0IHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50KTtcbiAgICAgIGxldCBtYXRyaXggPSBuZXcgRE9NTWF0cml4UmVhZE9ubHkoc3R5bGUudHJhbnNmb3JtKTtcbiAgICAgIHBvcyA9IG1hdHJpeC5tNDI7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGNvbnRhaW5lclRvcCwgcGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCwgdGFyZ2V0LCBwb3MpO1xuICAgIGN1cnJlbnQuY2xhc3NMaXN0LnJlbW92ZSgndmFyaWFudC0tY3VycmVudCcpO1xuICAgIEFycmF5LmZyb20oZWxlbWVudHMpW3RhcmdldEluZGV4XS5jbGFzc0xpc3QuYWRkKCd2YXJpYW50LS1jdXJyZW50Jyk7XG4gICAgcGFyZW50LnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGVZKCR7Y29udGFpbmVyVG9wIC0gdGFyZ2V0ICsgcG9zfXB4KWA7XG4gIH1cblxuICBmdW5jdGlvbiBTbGlkZXNTY3JvbGwoZWxlbWVudHMsIGlzRG93bikge1xuICAgIGxldCBjdXJyZW50ID0gQXJyYXkuZnJvbShlbGVtZW50cykuZmluZEluZGV4KGVsID0+IGVsLmNsYXNzTGlzdC5jb250YWlucygnc2hvdycpKTtcbiAgICBsZXQgdGFyZ2V0ID0gaXNEb3duID8gY3VycmVudCArIDEgOiBjdXJyZW50IC0gMTtcbiAgICBBcnJheS5mcm9tKGVsZW1lbnRzKVtjdXJyZW50XS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgQXJyYXkuZnJvbShlbGVtZW50cylbdGFyZ2V0XS5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG4gIH1cblxuICBmdW5jdGlvbiBTY3JvbGxUb0NlbnRlcihjb250YWluZXIsIGVsZW1lbnQsIGlzRG93bikge1xuICAgIGxldCBzdGFydCA9IG51bGw7XG4gICAgbGV0IGZpcnN0UG9zID0gd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7XG4gICAgbGV0IHdpbmRvd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICBsZXQgdGFyZ2V0ID0gaXNEb3duID8gKHdpbmRvd0hlaWdodCArIGVsZW1lbnQub2Zmc2V0SGVpZ2h0KSAvIDIgOiBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xuICAgIGxldCBwb3MgPSAwO1xuXG4gICAgY29uc29sZS5sb2coZmlyc3RQb3MsIHdpbmRvd0hlaWdodCwgZWxlbWVudC5vZmZzZXRIZWlnaHQsIGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wLCB0YXJnZXQsIHBvcyk7XG5cbiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGUnKTtcblxuICAgIChmdW5jdGlvbigpIHtcblxuICAgICAgY29uc3QgYnJvd3NlciA9IFsnbXMnLCAnbW96JywgJ3dlYmtpdCcsICdvJ107XG5cbiAgICAgIGZvcihsZXQgeCA9IDAsIGxlbmd0aCA9IGJyb3dzZXIubGVuZ3RoOyB4IDwgbGVuZ3RoICYmICF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lOyB4KyspIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvd1ticm93c2VyW3hdKydSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcbiAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gd2luZG93W2Jyb3dzZXJbeF0rJ0NhbmNlbEFuaW1hdGlvbkZyYW1lJ10gfHwgd2luZG93W2Jyb3dzZXJbeF0rJ0NhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZSddO1xuICAgICAgfVxuXG4gICAgfSgpKTtcblxuICAgIGZ1bmN0aW9uIHNob3dBbmltYXRpb24gKHRpbWVzdGFtcCkge1xuXG4gICAgICBpZighc3RhcnQpIHsgc3RhcnQgPSB0aW1lc3RhbXAgfHwgbmV3IERhdGUoKS5nZXRUaW1lKCk7IH0gLy9nZXQgaWQgb2YgYW5pbWF0aW9uXG5cbiAgICAgIGxldCBlbGFwc2VkID0gdGltZXN0YW1wIC0gc3RhcnQ7XG4gICAgICBsZXQgcHJvZ3Jlc3MgPSBlbGFwc2VkIC8gOTAwOyAvLyBhbmltYXRpb24gZHVyYXRpb24gNjAwbXNcbiAgICAgIHByb2dyZXNzID0gK3Byb2dyZXNzLnRvRml4ZWQoMik7XG5cbiAgICAgIC8vZWFzZSBpbiBmdW5jdGlvbiBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9jb21wb25lbnQvZWFzZS9ibG9iL21hc3Rlci9pbmRleC5qc1xuICAgICAgY29uc3Qgb3V0UXVhZCA9IGZ1bmN0aW9uKG4pe1xuICAgICAgICByZXR1cm4gbiAqICgyIC0gbik7XG4gICAgICB9O1xuXG4gICAgICBsZXQgZWFzZUluUGVyY2VudGFnZSA9ICsob3V0UXVhZChwcm9ncmVzcykpLnRvRml4ZWQoMik7XG5cbiAgICAgIHBvcyA9IGZpcnN0UG9zICsgKHRhcmdldCAqIGVhc2VJblBlcmNlbnRhZ2UpO1xuICAgICAgcG9zID0gK3Bvcy50b0ZpeGVkKDIpO1xuICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHBvcyk7XG5cbiAgICAgIGNvbnNvbGUubG9nKGZpcnN0UG9zLCB0YXJnZXQsIHBvcywgZWFzZUluUGVyY2VudGFnZSwgZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQgLSB3aW5kb3cuaW5uZXJIZWlnaHQpO1xuXG4gICAgICBpZiggcG9zIDwgMCB8fFxuICAgICAgICAhaXNEb3duICYmIHBvcyA8PSAwIHx8XG4gICAgICAgICFpc0Rvd24gJiYgcG9zIDw9IChmaXJzdFBvcyArIHRhcmdldCArIDEpIHx8XG4gICAgICAgIGlzRG93biAmJiBwb3MgPj0gKGZpcnN0UG9zICsgdGFyZ2V0KSB8fFxuICAgICAgICBpc0Rvd24gJiYgcG9zID49IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0IC0gd2luZG93LmlubmVySGVpZ2h0IC0gMSB8fFxuICAgICAgICBwb3MgPiBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCAtIHdpbmRvdy5pbm5lckhlaWdodCApIHtcbiAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoc3RhcnQpO1xuICAgICAgICBpZihlbGVtZW50KSB7XG4gICAgICAgICAgZWxlbWVudC5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICAgIHBvcyA9IDA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHNob3dBbmltYXRpb24pO1xuICAgICAgfVxuICAgIH1cbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHNob3dBbmltYXRpb24pO1xuICB9XG5cbiAgZnVuY3Rpb24gU2Nyb2xsVG9Cb3R0b20oY29udGFpbmVyLCBlbGVtZW50LCBpc0Rvd24pIHtcbiAgICBsZXQgc3RhcnQgPSBudWxsO1xuICAgIGxldCBmaXJzdFBvcyA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgIGxldCB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgbGV0IHRhcmdldCA9IGlzRG93biA/IChjb250YWluZXIub2Zmc2V0SGVpZ2h0IC0gd2luZG93SGVpZ2h0KSA6IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuYm90dG9tIC0gd2luZG93SGVpZ2h0O1xuICAgIGxldCBwb3MgPSAwO1xuXG4gICAgY29uc29sZS5sb2coZmlyc3RQb3MsIGVsZW1lbnQub2Zmc2V0SGVpZ2h0LCBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmJvdHRvbSwgdGFyZ2V0LCBwb3MpO1xuXG4gICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdhbmltYXRlJyk7XG5cbiAgICAoZnVuY3Rpb24oKSB7XG5cbiAgICAgIGNvbnN0IGJyb3dzZXIgPSBbJ21zJywgJ21veicsICd3ZWJraXQnLCAnbyddO1xuXG4gICAgICBmb3IobGV0IHggPSAwLCBsZW5ndGggPSBicm93c2VyLmxlbmd0aDsgeCA8IGxlbmd0aCAmJiAhd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZTsgeCsrKSB7XG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB3aW5kb3dbYnJvd3Nlclt4XSsnUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107XG4gICAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSA9IHdpbmRvd1ticm93c2VyW3hdKydDYW5jZWxBbmltYXRpb25GcmFtZSddIHx8IHdpbmRvd1ticm93c2VyW3hdKydDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcbiAgICAgIH1cblxuICAgIH0oKSk7XG5cbiAgICBmdW5jdGlvbiBzaG93QW5pbWF0aW9uICh0aW1lc3RhbXApIHtcblxuICAgICAgaWYoIXN0YXJ0KSB7IHN0YXJ0ID0gdGltZXN0YW1wIHx8IG5ldyBEYXRlKCkuZ2V0VGltZSgpOyB9IC8vZ2V0IGlkIG9mIGFuaW1hdGlvblxuXG4gICAgICBsZXQgZWxhcHNlZCA9IHRpbWVzdGFtcCAtIHN0YXJ0O1xuICAgICAgbGV0IHByb2dyZXNzID0gZWxhcHNlZCAvIDkwMDsgLy8gYW5pbWF0aW9uIGR1cmF0aW9uIDYwMG1zXG4gICAgICBwcm9ncmVzcyA9ICtwcm9ncmVzcy50b0ZpeGVkKDIpO1xuXG4gICAgICAvL2Vhc2UgaW4gZnVuY3Rpb24gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vY29tcG9uZW50L2Vhc2UvYmxvYi9tYXN0ZXIvaW5kZXguanNcbiAgICAgIGNvbnN0IG91dFF1YWQgPSBmdW5jdGlvbihuKXtcbiAgICAgICAgcmV0dXJuIG4gKiAoMiAtIG4pO1xuICAgICAgfTtcblxuICAgICAgbGV0IGVhc2VJblBlcmNlbnRhZ2UgPSArKG91dFF1YWQocHJvZ3Jlc3MpKS50b0ZpeGVkKDIpO1xuXG4gICAgICBwb3MgPSBmaXJzdFBvcyArICh0YXJnZXQgKiBlYXNlSW5QZXJjZW50YWdlKTtcbiAgICAgIHBvcyA9ICtwb3MudG9GaXhlZCgyKTtcbiAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCBwb3MpO1xuXG4gICAgICBjb25zb2xlLmxvZyhmaXJzdFBvcywgdGFyZ2V0LCBwb3MsIGVhc2VJblBlcmNlbnRhZ2UsIGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0IC0gd2luZG93LmlubmVySGVpZ2h0KTtcblxuICAgICAgaWYoIHBvcyA8IDAgfHxcbiAgICAgICAgIWlzRG93biAmJiBwb3MgPD0gMCB8fFxuICAgICAgICAhaXNEb3duICYmIHBvcyA8PSAoZmlyc3RQb3MgKyB0YXJnZXQgKyAxKSB8fFxuICAgICAgICBpc0Rvd24gJiYgcG9zID49IChmaXJzdFBvcyArIHRhcmdldCkgfHxcbiAgICAgICAgaXNEb3duICYmIHBvcyA+PSBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCAtIHdpbmRvdy5pbm5lckhlaWdodCAtIDEgfHxcbiAgICAgICAgcG9zID4gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQgLSB3aW5kb3cuaW5uZXJIZWlnaHQgKSB7XG4gICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHN0YXJ0KTtcbiAgICAgICAgaWYoZWxlbWVudCkge1xuICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgICBwb3MgPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzaG93QW5pbWF0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzaG93QW5pbWF0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIFdoZWVsKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgbGV0IGN1cnJlbnQgPSBBcnJheS5mcm9tKHNlY3Rpb25zKS5maW5kSW5kZXgoIHNlY3Rpb24gPT4gc2VjdGlvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2FuaW1hdGUnKSApO1xuICAgIGxldCB0YXJnZXQ7XG4gICAgaWYgKGUuZGVsdGFZID4gMCkge1xuICAgICAgdGFyZ2V0ID0gY3VycmVudCArIDEgPCBzZWN0aW9ucy5sZW5ndGggPyBBcnJheS5mcm9tKHNlY3Rpb25zKVtjdXJyZW50ICsgMV0gOiBBcnJheS5mcm9tKHNlY3Rpb25zKVtjdXJyZW50XTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGFyZ2V0ID0gY3VycmVudCA+IDAgPyBBcnJheS5mcm9tKHNlY3Rpb25zKVtjdXJyZW50IC0gMV0gOiBBcnJheS5mcm9tKHNlY3Rpb25zKVswXTtcbiAgICB9XG5cbiAgICBpZiAoc2VjdGlvbnNbY3VycmVudF0uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWN0aW9uLS12YXJpYW50cycpKSB7XG4gICAgICBsZXQgdmFyaWFudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VjdGlvbi0tdmFyaWFudHMgLnZhcmlhbnQnKTtcbiAgICAgIGlmIChlLmRlbHRhWSA+IDAgJiYgdmFyaWFudHNbdmFyaWFudHMubGVuZ3RoIC0gMV0uY2xhc3NMaXN0LmNvbnRhaW5zKCd2YXJpYW50LS1jdXJyZW50JykgfHxcbiAgICAgICAgZS5kZWx0YVkgPCAwICYmIHZhcmlhbnRzWzBdLmNsYXNzTGlzdC5jb250YWlucygndmFyaWFudC0tY3VycmVudCcpKSB7XG4gICAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LCBlLmRlbHRhWSA+IDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3IElubmVyU2Nyb2xsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLS12YXJpYW50cycpLCB2YXJpYW50cywgZS5kZWx0YVkgPiAwKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoc2VjdGlvbnNbY3VycmVudF0uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWN0aW9uLS13b3JsZCcpKSB7XG4gICAgICBsZXQgc2xpZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlY3Rpb24tLXdvcmxkIC5zZWN0aW9uX19zbGlkZScpO1xuICAgICAgaWYgKGUuZGVsdGFZID4gMCAmJiBzbGlkZXNbc2xpZGVzLmxlbmd0aCAtIDFdLmNsYXNzTGlzdC5jb250YWlucygnc2hvdycpIHx8XG4gICAgICAgIGUuZGVsdGFZIDwgMCAmJiBzbGlkZXNbMF0uY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93JykpIHtcbiAgICAgICAgbmV3IFNjcm9sbCh0YXJnZXQsIGUuZGVsdGFZID4gMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXcgU2xpZGVzU2Nyb2xsKHNsaWRlcywgZS5kZWx0YVkgPiAwKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoXG4gICAgICBzZWN0aW9uc1tjdXJyZW50XS5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLWJhY2tzdG9yeScpICYmIGUuZGVsdGFZID4gMCB8fFxuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tYmFja3N0b3J5JykgJiYgZS5kZWx0YVkgPCAwIHx8XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYW5pbWF0ZScpLmNsYXNzTGlzdC5jb250YWlucygncGxhY2UnKVxuICAgICkge1xuICAgICAgbGV0IHBsYWNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tLWJhY2tzdG9yeSAucGxhY2UnKTtcbiAgICAgIGlmIChzZWN0aW9uc1tjdXJyZW50XS5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLWJhY2tzdG9yeScpKSB7XG4gICAgICAgIG5ldyBTY3JvbGxUb0NlbnRlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbi0tYmFja3N0b3J5JyksIHBsYWNlLCBlLmRlbHRhWSA+IDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHRhcmdldEluZGV4ID0gZS5kZWx0YVkgPiAwID9cbiAgICAgICAgICBBcnJheS5mcm9tKHNlY3Rpb25zKS5maW5kSW5kZXgoZWwgPT4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWN0aW9uLS1vcHBvcnR1bml0aWVzJykpIDpcbiAgICAgICAgICBBcnJheS5mcm9tKHNlY3Rpb25zKS5maW5kSW5kZXgoZWwgPT4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWN0aW9uLS1iYWNrc3RvcnknKSk7XG4gICAgICAgIHRhcmdldCA9IEFycmF5LmZyb20oc2VjdGlvbnMpW3RhcmdldEluZGV4XTtcbiAgICAgICAgbmV3IFNjcm9sbCh0YXJnZXQsIGUuZGVsdGFZID4gMCk7XG4gICAgICAgIHBsYWNlLmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoXG4gICAgICBzZWN0aW9uc1tjdXJyZW50XS5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLW9wcG9ydHVuaXRpZXMnKSAmJiBlLmRlbHRhWSA+IDAgfHxcbiAgICAgIHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLW9wcG9ydHVuaXRpZXMnKSAmJiBlLmRlbHRhWSA8IDAgfHxcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hbmltYXRlJykuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb21tdW5pdHknKVxuICAgICkge1xuICAgICAgbGV0IGNvbW11bml0eSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLS1vcHBvcnR1bml0aWVzIC5jb21tdW5pdHknKTtcbiAgICAgIGlmIChzZWN0aW9uc1tjdXJyZW50XS5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLW9wcG9ydHVuaXRpZXMnKSkge1xuICAgICAgICBuZXcgU2Nyb2xsVG9DZW50ZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tLW9wcG9ydHVuaXRpZXMnKSwgY29tbXVuaXR5LCBlLmRlbHRhWSA+IDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHRhcmdldEluZGV4ID0gZS5kZWx0YVkgPiAwID9cbiAgICAgICAgICBBcnJheS5mcm9tKHNlY3Rpb25zKS5maW5kSW5kZXgoZWwgPT4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWN0aW9uLS1yb2FkbWFwJykpIDpcbiAgICAgICAgICBBcnJheS5mcm9tKHNlY3Rpb25zKS5maW5kSW5kZXgoZWwgPT4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWN0aW9uLS1vcHBvcnR1bml0aWVzJykpO1xuICAgICAgICB0YXJnZXQgPSBBcnJheS5mcm9tKHNlY3Rpb25zKVt0YXJnZXRJbmRleF07XG4gICAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LCBlLmRlbHRhWSA+IDApO1xuICAgICAgICBjb21tdW5pdHkuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZScpO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChcbiAgICAgIHNlY3Rpb25zW2N1cnJlbnRdLmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tcm9hZG1hcCcpICYmIGUuZGVsdGFZID4gMCB8fFxuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tcm9hZG1hcCcpICYmIGUuZGVsdGFZIDwgMCB8fFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFuaW1hdGUnKS5jbGFzc0xpc3QuY29udGFpbnMoJ2V4cGVydGlzZScpXG4gICAgKSB7XG4gICAgICBsZXQgZXhwZXJ0aXNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tLXJvYWRtYXAgLmV4cGVydGlzZScpO1xuICAgICAgaWYgKHNlY3Rpb25zW2N1cnJlbnRdLmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tcm9hZG1hcCcpKSB7XG4gICAgICAgIG5ldyBTY3JvbGxUb0JvdHRvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbi0tcm9hZG1hcCcpLCBleHBlcnRpc2UsIGUuZGVsdGFZID4gMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgdGFyZ2V0SW5kZXggPSBlLmRlbHRhWSA+IDAgP1xuICAgICAgICAgIEFycmF5LmZyb20oc2VjdGlvbnMpLmZpbmRJbmRleChlbCA9PiBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3NlY3Rpb24tLXBhcnRuZXJzJykpIDpcbiAgICAgICAgICBBcnJheS5mcm9tKHNlY3Rpb25zKS5maW5kSW5kZXgoZWwgPT4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWN0aW9uLS1yb2FkbWFwJykpO1xuICAgICAgICB0YXJnZXQgPSBBcnJheS5mcm9tKHNlY3Rpb25zKVt0YXJnZXRJbmRleF07XG4gICAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LCBlLmRlbHRhWSA+IDApO1xuICAgICAgICBleHBlcnRpc2UuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZScpO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LCBlLmRlbHRhWSA+IDApO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIFdoZWVsLCB7cGFzc2l2ZTogZmFsc2V9KTtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNld2hlZWwnLCBXaGVlbCwge3Bhc3NpdmU6IGZhbHNlfSk7XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Nb3VzZVNjcm9sbCcsIFdoZWVsLCB7cGFzc2l2ZTogZmFsc2V9KTtcblxuICBkb2N1bWVudC5vbmtleXVwID0gZnVuY3Rpb24oZSl7XG4gICAgY29uc29sZS5sb2coJ0tleSA6ICcgKyBlLmNvZGUpO1xuICAgIGxldCBjdXJyZW50ID0gQXJyYXkuZnJvbShzZWN0aW9ucykuZmluZEluZGV4KCBzZWN0aW9uID0+IHNlY3Rpb24uY2xhc3NMaXN0LmNvbnRhaW5zKCdhbmltYXRlJykgKTtcbiAgICBsZXQgdGFyZ2V0O1xuICAgIGlmIChlLmNvZGUgPT09ICgnU3BhY2UnIHx8ICdBcnJvd0Rvd24nIHx8ICdQYWdlRG93bicgfHwgJ0Rvd24nKSkge1xuICAgICAgdGFyZ2V0ID0gY3VycmVudCArIDEgPCBzZWN0aW9ucy5sZW5ndGggPyBBcnJheS5mcm9tKHNlY3Rpb25zKVtjdXJyZW50ICsgMV0gOiBBcnJheS5mcm9tKHNlY3Rpb25zKVtjdXJyZW50XTtcbiAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LCB0cnVlKTtcbiAgICB9IGVsc2UgaWYgKGUuY29kZSA9PT0gKCdBcnJvd1VwJyB8fCAnUGFnZVVwJyB8fCAnVXAnKSkge1xuICAgICAgdGFyZ2V0ID0gY3VycmVudCA+IDAgPyBBcnJheS5mcm9tKHNlY3Rpb25zKVtjdXJyZW50IC0gMV0gOiBBcnJheS5mcm9tKHNlY3Rpb25zKVswXTtcbiAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LCBmYWxzZSk7XG4gICAgfVxuICB9O1xuXG4gIGxldCBzcGxpZGUgPSBuZXcgU3BsaWRlKCAnLnNwbGlkZScsIHtcbiAgICBwZXJQYWdlOiAzLFxuICAgIHBlck1vdmU6IDEsXG4gICAgZ2FwICAgIDogJzMycHgnLFxuICAgIGJyZWFrcG9pbnRzOiB7XG4gICAgICA4MjA6IHtcbiAgICAgICAgcGVyUGFnZTogMlxuICAgICAgfSxcbiAgICAgIDUyMDoge1xuICAgICAgICBwZXJQYWdlOiAxXG4gICAgICB9LFxuICAgIH0sXG4gIH0gKTtcblxuICBzcGxpZGUubW91bnQoKTtcbn07XG4iXX0=
