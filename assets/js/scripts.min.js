/*!
 * gulp-nunjucks-sass-template
 * A Gulp 4 template including SCSS, Nunjucks, JS and more
 *
 * Url: https://github.com/DefaultSimon
 * Author: Simon GoriÄar
 * Copyright 2022. License: MIT
 */
window.onload=function(){const e=new IntersectionObserver(function(e,t){e.forEach(e=>{e.isIntersecting?(e.target.classList.remove("animate-off"),e.target.classList.add("animate")):(e.target.classList.remove("animate"),e.target.classList.add("animate-off"))})},{root:null,rootMargin:"24px",threshold:.5});function t(e){let t=window.innerWidth/2,n=window.innerHeight/2,s=e.clientX,a=e.clientY;this.querySelectorAll(".parallaxed").forEach((e,o)=>{let i=-.001*o-.001;e.style.marginLeft=`${(s-t)*i}%`,e.style.marginTop=`${(a-n)*i}%`})}document.querySelectorAll("section").forEach(t=>e.observe(t)),document.querySelectorAll(".parallax").forEach(e=>{e.addEventListener("mousemove",t)});const n=document.querySelectorAll(".section");let s=!1;function a(e,t,n,a){s=!0;let o=null,i=window.pageYOffset||document.documentElement.scrollTop,c=window.innerHeight,r=0,l=0;r="center"===a?t?(c+e.offsetHeight)/2:e.parentElement.getBoundingClientRect().top+(c+e.offsetHeight)/2:"bottom"===a?e.parentElement.getBoundingClientRect().bottom-c:e.getBoundingClientRect().top,console.log(i,r,l,e),function(){const e=["ms","moz","webkit","o"];for(let t=0,n=e.length;t<n&&!window.requestAnimationFrame;t++)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"]}(),window.requestAnimationFrame(function a(c){o||(o=c||(new Date).getTime());let d=(c-o)/+n;d=+d.toFixed(2);let m=+(f=d,f*(2-f)).toFixed(2);var f;l=+(l=i+r*m).toFixed(2),window.scrollTo(0,l),isNaN(l)||l<0||!t&&l<=0||!t&&l<=i+r+1||t&&l>=i+r||t&&l>=document.body.clientHeight-window.innerHeight-1||l>document.body.clientHeight-window.innerHeight?(cancelAnimationFrame(o),e&&e.focus(),l=0,s=!1):window.requestAnimationFrame(a)})}function o(e,t,n,s){!n&&t.offsetHeight<window.innerHeight||(e.classList.add("animate-fade"),t.classList.remove("animate-fade"))}function i(e,t){e.preventDefault();let i=t||e.deltaY>0;if(!s){let e,t=Array.from(n).findIndex(e=>e.classList.contains("animate"));if(e=i?t+1<n.length?Array.from(n)[t+1]:Array.from(n)[t]:t>0?Array.from(n)[t-1]:Array.from(n)[0],console.log(n[t],e),n[t].classList.contains("section--variants")){let t=document.querySelectorAll(".section--variants .variant");i&&t[t.length-1].classList.contains("variant--current")||!i&&t[0].classList.contains("variant--current")?new a(e,i,600):new function(e,t,n){s=!0;let a=e.querySelector(".section__variants").getBoundingClientRect().top,o=e.querySelector("ul"),i=e.querySelector(".variant--current"),c=n?Array.from(t).findIndex(e=>e.classList.contains("variant--current"))+1:Array.from(t).findIndex(e=>e.classList.contains("variant--current"))-1,r=Array.from(t)[c].getBoundingClientRect().top,l=0;if(o.style.transform){let e=window.getComputedStyle(o);l=new DOMMatrixReadOnly(e.transform).m42}console.log(a,o.getBoundingClientRect().top,r,l),i.classList.remove("variant--current"),Array.from(t)[c].classList.add("variant--current"),o.style.transform=`translateY(${a-r+l}px)`,setTimeout(()=>s=!1,300)}(document.querySelector(".section--variants"),t,i)}else if(n[t].classList.contains("section--world")){let o=document.querySelectorAll(".section--world .section__slide");i&&o[o.length-1].classList.contains("show")||!i&&o[0].classList.contains("show")?new a(e,i,600):new function(e,t,n){s=!0;let a=Array.from(t).findIndex(e=>e.classList.contains("show")),o=n?a+1:a-1;Array.from(t)[a].classList.remove("show"),Array.from(t)[o].classList.add("show"),e.setAttribute("data-slide",+o),setTimeout(()=>s=!1,300)}(n[t],o,i)}else if(n[t].classList.contains("section--roadmap")||e.classList.contains("section--roadmap")&&!i||e.classList.contains("section--opportunities")&&!i){let s=document.querySelector(".section--roadmap .expertise");s.classList.contains("animate-off")?i?(new o(n[t].querySelector(".section__content"),s,i,900),new a(s,i,900,"bottom"),s.classList.remove("animate-off")):(e.querySelector(".community").classList.remove("animate-fade"),new a(e.querySelector(".community"),i,900,"center")):s.classList.contains("animate-fade")?(s.classList.remove("animate-fade"),e.querySelector(".section__content").classList.add("animate-fade"),new a(s,i,900,"bottom")):i?(new a(e,i,600),s.classList.add("animate-fade")):(new a(n[t],i,600),s.classList.add("animate-off"),n[t].querySelector(".section__content").classList.remove("animate-fade"))}else if(n[t].classList.contains("section--opportunities")||e.classList.contains("section--opportunities")&&!i||e.classList.contains("section--backstory")&&!i){let s=document.querySelector(".section--opportunities .community");s.classList.contains("animate-off")?i?(s.classList.remove("animate-off"),new o(n[t].querySelector(".section__content"),s,i,900),new a(s,i,900,"center")):(e.querySelector(".place").classList.remove("animate-fade"),new a(e.querySelector(".place"),i,900,"center")):s.classList.contains("animate-fade")?(s.classList.remove("animate-fade"),e.querySelector(".section__content").classList.add("animate-fade"),new a(s,i,900,"center")):i?(new a(s,i,900,"center"),s.classList.add("animate-fade")):(new a(n[t],i,600),s.classList.add("animate-off"),n[t].querySelector(".section__content").classList.remove("animate-fade"))}else if(n[t].classList.contains("section--backstory")||e.classList.contains("section--backstory")&&!i||e.classList.contains("section--world")&&!i){let s=document.querySelector(".section--backstory .place");s.classList.contains("animate-off")?i?(s.classList.remove("animate-off"),new o(n[t].querySelector(".section__content"),s,i,900),new a(s,i,900,"center")):(n[t].classList.remove("animate-off"),new a(e,i,600)):s.classList.contains("animate-fade")?(s.classList.remove("animate-fade"),e.querySelector(".section__content").classList.add("animate-fade"),new a(s,i,900,"center")):i?(new a(s,i,900,"center"),s.classList.add("animate-fade")):(new a(n[t],i,600),s.classList.add("animate-off"),n[t].querySelector(".section__content").classList.remove("animate-fade"))}else new a(e,i,600)}}window.addEventListener("wheel",i,{passive:!1}),window.addEventListener("mousewheel",i,{passive:!1}),window.addEventListener("DOMMouseScroll",i,{passive:!1});let c=0;document.body.ontouchstart=function(e){c=e.changedTouches[0].clientY},window.addEventListener("touchmove",e=>{const t=Math.round(e.changedTouches[0].screenY);c!==t&&new i(e,c-t>0)}),new Splide(".splide",{perPage:3,perMove:1,gap:"32px",breakpoints:{820:{perPage:2},520:{perPage:1}}}).mount()};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMuanMiXSwibmFtZXMiOlsid2luZG93Iiwib25sb2FkIiwib2JzZXJ2ZXIiLCJJbnRlcnNlY3Rpb25PYnNlcnZlciIsImVudHJpZXMiLCJmb3JFYWNoIiwiZW50cnkiLCJpc0ludGVyc2VjdGluZyIsInRhcmdldCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCIsInJvb3QiLCJyb290TWFyZ2luIiwidGhyZXNob2xkIiwiUGFyYWxsYXgiLCJlIiwiX3ciLCJpbm5lcldpZHRoIiwiX2giLCJpbm5lckhlaWdodCIsIl9tb3VzZVgiLCJjbGllbnRYIiwiX21vdXNlWSIsImNsaWVudFkiLCJ0aGlzIiwicXVlcnlTZWxlY3RvckFsbCIsImVsIiwiaW5kZXgiLCJtdWx0aXBseSIsInN0eWxlIiwibWFyZ2luTGVmdCIsIm1hcmdpblRvcCIsImRvY3VtZW50Iiwib2JzZXJ2ZSIsInBhcmFsbGF4IiwiYWRkRXZlbnRMaXN0ZW5lciIsInNlY3Rpb25zIiwiaXNTY3JvbGxpbmciLCJTY3JvbGwiLCJlbGVtZW50IiwiaXNEb3duIiwic3BlZWQiLCJ0eXBlIiwic3RhcnQiLCJmaXJzdFBvcyIsInBhZ2VZT2Zmc2V0IiwiZG9jdW1lbnRFbGVtZW50Iiwic2Nyb2xsVG9wIiwid2luZG93SGVpZ2h0IiwicG9zIiwib2Zmc2V0SGVpZ2h0IiwicGFyZW50RWxlbWVudCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsImJvdHRvbSIsImNvbnNvbGUiLCJsb2ciLCJicm93c2VyIiwieCIsImxlbmd0aCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImNhbmNlbEFuaW1hdGlvbkZyYW1lIiwic2hvd0FuaW1hdGlvbiIsInRpbWVzdGFtcCIsIkRhdGUiLCJnZXRUaW1lIiwicHJvZ3Jlc3MiLCJ0b0ZpeGVkIiwiZWFzZUluUGVyY2VudGFnZSIsIm4iLCJzY3JvbGxUbyIsImlzTmFOIiwiYm9keSIsImNsaWVudEhlaWdodCIsImZvY3VzIiwiQW5pbWF0ZUZhZGUiLCJjdXJyZW50IiwiaWREb3duIiwidGltZSIsIldoZWVsIiwiZG93biIsInByZXZlbnREZWZhdWx0IiwiZGVsdGFZIiwiQXJyYXkiLCJmcm9tIiwiZmluZEluZGV4Iiwic2VjdGlvbiIsImNvbnRhaW5zIiwidmFyaWFudHMiLCJjb250YWluZXIiLCJlbGVtZW50cyIsImNvbnRhaW5lclRvcCIsInF1ZXJ5U2VsZWN0b3IiLCJwYXJlbnQiLCJ0YXJnZXRJbmRleCIsInRyYW5zZm9ybSIsImdldENvbXB1dGVkU3R5bGUiLCJET01NYXRyaXhSZWFkT25seSIsIm00MiIsInNldFRpbWVvdXQiLCJzbGlkZXMiLCJzZXRBdHRyaWJ1dGUiLCJleHBlcnRpc2UiLCJjb21tdW5pdHkiLCJwbGFjZSIsInBhc3NpdmUiLCJ0b3VjaFN0YXJ0UG9zWSIsIm9udG91Y2hzdGFydCIsImNoYW5nZWRUb3VjaGVzIiwiY3VycmVudFBhZ2VZIiwiTWF0aCIsInJvdW5kIiwic2NyZWVuWSIsIlNwbGlkZSIsInBlclBhZ2UiLCJwZXJNb3ZlIiwiZ2FwIiwiYnJlYWtwb2ludHMiLCI4MjAiLCI1MjAiLCJtb3VudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQUEsT0FBQUMsT0FBQSxXQWFBLE1BQUFDLEVBQUEsSUFBQUMscUJBTkEsU0FBQUMsRUFBQUYsR0FQQUUsRUFBQUMsUUFBQUMsSUFDQUEsRUFBQUMsZ0JBRUFELEVBQUFFLE9BQUFDLFVBQUFDLE9BQUEsZUFDQUosRUFBQUUsT0FBQUMsVUFBQUUsSUFBQSxhQUdBTCxFQUFBRSxPQUFBQyxVQUFBQyxPQUFBLFdBQ0FKLEVBQUFFLE9BQUFDLFVBQUFFLElBQUEsb0JBTkFDLEtBQUEsS0FDQUMsV0FBQSxPQUNBQyxVQUFBLEtBY0EsU0FBQUMsRUFBQUMsR0FDQSxJQUFBQyxFQUFBakIsT0FBQWtCLFdBQUEsRUFDQUMsRUFBQW5CLE9BQUFvQixZQUFBLEVBQ0FDLEVBQUFMLEVBQUFNLFFBQ0FDLEVBQUFQLEVBQUFRLFFBQ0FDLEtBQUFDLGlCQUFBLGVBQ0FyQixRQUFBLENBQUFzQixFQUFBQyxLQUNBLElBQUFDLEdBQUEsS0FBQUQsRUFBQSxLQUNBRCxFQUFBRyxNQUFBQyxlQUFBVixFQUFBSixHQUFBWSxLQUNBRixFQUFBRyxNQUFBRSxjQUFBVCxFQUFBSixHQUFBVSxPQVpBSSxTQUFBUCxpQkFBQSxXQUNBckIsUUFBQXNCLEdBQUF6QixFQUFBZ0MsUUFBQVAsSUFlQU0sU0FBQVAsaUJBQUEsYUFDQXJCLFFBQUE4QixJQUNBQSxFQUFBQyxpQkFBQSxZQUFBckIsS0FHQSxNQUFBc0IsRUFBQUosU0FBQVAsaUJBQUEsWUFLQSxJQUFBWSxHQUFBLEVBRUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQUwsR0FBQSxFQUNBLElBQUFNLEVBQUEsS0FDQUMsRUFBQTdDLE9BQUE4QyxhQUFBYixTQUFBYyxnQkFBQUMsVUFDQUMsRUFBQWpELE9BQUFvQixZQUNBWixFQUFBLEVBQ0EwQyxFQUFBLEVBR0ExQyxFQURBLFdBQUFtQyxFQUNBRixHQUFBUSxFQUFBVCxFQUFBVyxjQUFBLEVBQUFYLEVBQUFZLGNBQUFDLHdCQUFBQyxLQUFBTCxFQUFBVCxFQUFBVyxjQUFBLEVBQ0EsV0FBQVIsRUFDQUgsRUFBQVksY0FBQUMsd0JBQUFFLE9BQUFOLEVBRUFULEVBQUFhLHdCQUFBQyxJQUdBRSxRQUFBQyxJQUFBWixFQUFBckMsRUFBQTBDLEVBQUFWLEdBRUEsV0FFQSxNQUFBa0IsR0FBQSxLQUFBLE1BQUEsU0FBQSxLQUVBLElBQUEsSUFBQUMsRUFBQSxFQUFBQyxFQUFBRixFQUFBRSxPQUFBRCxFQUFBQyxJQUFBNUQsT0FBQTZELHNCQUFBRixJQUNBM0QsT0FBQTZELHNCQUFBN0QsT0FBQTBELEVBQUFDLEdBQUEseUJBQ0EzRCxPQUFBOEQscUJBQUE5RCxPQUFBMEQsRUFBQUMsR0FBQSx5QkFBQTNELE9BQUEwRCxFQUFBQyxHQUFBLCtCQU5BLEdBa0RBM0QsT0FBQTZELHNCQXZDQSxTQUFBRSxFQUFBQyxHQUVBcEIsSUFBQUEsRUFBQW9CLElBQUEsSUFBQUMsTUFBQUMsV0FFQSxJQUNBQyxHQURBSCxFQUFBcEIsSUFDQUYsRUFDQXlCLEdBQUFBLEVBQUFDLFFBQUEsR0FTQSxJQUFBQyxJQUpBQyxFQUlBSCxFQUhBRyxHQUFBLEVBQUFBLElBR0FGLFFBQUEsR0FKQSxJQUFBRSxFQU9BcEIsSUFEQUEsRUFBQUwsRUFBQXJDLEVBQUE2RCxHQUNBRCxRQUFBLEdBQ0FwRSxPQUFBdUUsU0FBQSxFQUFBckIsR0FJQXNCLE1BQUF0QixJQUFBQSxFQUFBLElBQ0FULEdBQUFTLEdBQUEsSUFDQVQsR0FBQVMsR0FBQUwsRUFBQXJDLEVBQUEsR0FDQWlDLEdBQUFTLEdBQUFMLEVBQUFyQyxHQUNBaUMsR0FBQVMsR0FBQWpCLFNBQUF3QyxLQUFBQyxhQUFBMUUsT0FBQW9CLFlBQUEsR0FDQThCLEVBQUFqQixTQUFBd0MsS0FBQUMsYUFBQTFFLE9BQUFvQixhQUNBMEMscUJBQUFsQixHQUNBSixHQUNBQSxFQUFBbUMsUUFFQXpCLEVBQUEsRUFDQVosR0FBQSxHQUVBdEMsT0FBQTZELHNCQUFBRSxLQXNDQSxTQUFBYSxFQUFBQyxFQUFBckUsRUFBQXNFLEVBQUFDLElBQ0FELEdBQUF0RSxFQUFBMkMsYUFBQW5ELE9BQUFvQixjQUNBeUQsRUFBQXBFLFVBQUFFLElBQUEsZ0JBQ0FILEVBQUFDLFVBQUFDLE9BQUEsaUJBSUEsU0FBQXNFLEVBQUFoRSxFQUFBaUUsR0FDQWpFLEVBQUFrRSxpQkFDQSxJQUFBekMsRUFBQXdDLEdBQUFqRSxFQUFBbUUsT0FBQSxFQUNBLElBQUE3QyxFQUFBLENBQ0EsSUFDQTlCLEVBREFxRSxFQUFBTyxNQUFBQyxLQUFBaEQsR0FBQWlELFVBQUFDLEdBQUFBLEVBQUE5RSxVQUFBK0UsU0FBQSxZQVVBLEdBUEFoRixFQURBaUMsRUFDQW9DLEVBQUEsRUFBQXhDLEVBQUF1QixPQUFBd0IsTUFBQUMsS0FBQWhELEdBQUF3QyxFQUFBLEdBQUFPLE1BQUFDLEtBQUFoRCxHQUFBd0MsR0FFQUEsRUFBQSxFQUFBTyxNQUFBQyxLQUFBaEQsR0FBQXdDLEVBQUEsR0FBQU8sTUFBQUMsS0FBQWhELEdBQUEsR0FHQW1CLFFBQUFDLElBQUFwQixFQUFBd0MsR0FBQXJFLEdBRUE2QixFQUFBd0MsR0FBQXBFLFVBQUErRSxTQUFBLHFCQUFBLENBQ0EsSUFBQUMsRUFBQXhELFNBQUFQLGlCQUFBLCtCQUVBZSxHQUFBZ0QsRUFBQUEsRUFBQTdCLE9BQUEsR0FBQW5ELFVBQUErRSxTQUFBLHNCQUNBL0MsR0FBQWdELEVBQUEsR0FBQWhGLFVBQUErRSxTQUFBLG9CQUVBLElBQUFqRCxFQUFBL0IsRUFBQWlDLEVBQUEsS0FFQSxJQTdEQSxTQUFBaUQsRUFBQUMsRUFBQWxELEdBQ0FILEdBQUEsRUFDQSxJQUFBc0QsRUFBQUYsRUFBQUcsY0FBQSxzQkFBQXhDLHdCQUFBQyxJQUNBd0MsRUFBQUosRUFBQUcsY0FBQSxNQUNBaEIsRUFBQWEsRUFBQUcsY0FBQSxxQkFDQUUsRUFBQXRELEVBQ0EyQyxNQUFBQyxLQUFBTSxHQUFBTCxVQUFBM0QsR0FBQUEsRUFBQWxCLFVBQUErRSxTQUFBLHFCQUFBLEVBQ0FKLE1BQUFDLEtBQUFNLEdBQUFMLFVBQUEzRCxHQUFBQSxFQUFBbEIsVUFBQStFLFNBQUEscUJBQUEsRUFDQWhGLEVBQUE0RSxNQUFBQyxLQUFBTSxHQUFBSSxHQUFBMUMsd0JBQUFDLElBQ0FKLEVBQUEsRUFDQSxHQUFBNEMsRUFBQWhFLE1BQUFrRSxVQUFBLENBQ0EsSUFBQWxFLEVBQUE5QixPQUFBaUcsaUJBQUFILEdBRUE1QyxFQURBLElBQUFnRCxrQkFBQXBFLEVBQUFrRSxXQUNBRyxJQUVBM0MsUUFBQUMsSUFBQW1DLEVBQUFFLEVBQUF6Qyx3QkFBQUMsSUFBQTlDLEVBQUEwQyxHQUNBMkIsRUFBQXBFLFVBQUFDLE9BQUEsb0JBQ0EwRSxNQUFBQyxLQUFBTSxHQUFBSSxHQUFBdEYsVUFBQUUsSUFBQSxvQkFDQW1GLEVBQUFoRSxNQUFBa0Usd0JBQUFKLEVBQUFwRixFQUFBMEMsT0FDQWtELFdBQUEsSUFBQTlELEdBQUEsRUFBQSxLQTBDQSxDQUFBTCxTQUFBNEQsY0FBQSxzQkFBQUosRUFBQWhELFFBR0EsR0FBQUosRUFBQXdDLEdBQUFwRSxVQUFBK0UsU0FBQSxrQkFBQSxDQUNBLElBQUFhLEVBQUFwRSxTQUFBUCxpQkFBQSxtQ0FDQWUsR0FBQTRELEVBQUFBLEVBQUF6QyxPQUFBLEdBQUFuRCxVQUFBK0UsU0FBQSxVQUNBL0MsR0FBQTRELEVBQUEsR0FBQTVGLFVBQUErRSxTQUFBLFFBQ0EsSUFBQWpELEVBQUEvQixFQUFBaUMsRUFBQSxLQUVBLElBaERBLFNBQUFpRCxFQUFBQyxFQUFBbEQsR0FDQUgsR0FBQSxFQUNBLElBQUF1QyxFQUFBTyxNQUFBQyxLQUFBTSxHQUFBTCxVQUFBM0QsR0FBQUEsRUFBQWxCLFVBQUErRSxTQUFBLFNBQ0FoRixFQUFBaUMsRUFBQW9DLEVBQUEsRUFBQUEsRUFBQSxFQUNBTyxNQUFBQyxLQUFBTSxHQUFBZCxHQUFBcEUsVUFBQUMsT0FBQSxRQUNBMEUsTUFBQUMsS0FBQU0sR0FBQW5GLEdBQUFDLFVBQUFFLElBQUEsUUFDQStFLEVBQUFZLGFBQUEsY0FBQTlGLEdBQ0E0RixXQUFBLElBQUE5RCxHQUFBLEVBQUEsS0F5Q0EsQ0FBQUQsRUFBQXdDLEdBQUF3QixFQUFBNUQsUUFHQSxHQUNBSixFQUFBd0MsR0FBQXBFLFVBQUErRSxTQUFBLHFCQUNBaEYsRUFBQUMsVUFBQStFLFNBQUEsc0JBQUEvQyxHQUNBakMsRUFBQUMsVUFBQStFLFNBQUEsNEJBQUEvQyxFQUNBLENBQ0EsSUFBQThELEVBQUF0RSxTQUFBNEQsY0FBQSxnQ0FDQVUsRUFBQTlGLFVBQUErRSxTQUFBLGVBQ0EvQyxHQUNBLElBQUFtQyxFQUFBdkMsRUFBQXdDLEdBQUFnQixjQUFBLHFCQUFBVSxFQUFBOUQsRUFBQSxLQUNBLElBQUFGLEVBQUFnRSxFQUFBOUQsRUFBQSxJQUFBLFVBQ0E4RCxFQUFBOUYsVUFBQUMsT0FBQSxpQkFFQUYsRUFBQXFGLGNBQUEsY0FBQXBGLFVBQUFDLE9BQUEsZ0JBQ0EsSUFBQTZCLEVBQUEvQixFQUFBcUYsY0FBQSxjQUFBcEQsRUFBQSxJQUFBLFdBRUE4RCxFQUFBOUYsVUFBQStFLFNBQUEsaUJBQ0FlLEVBQUE5RixVQUFBQyxPQUFBLGdCQUNBRixFQUFBcUYsY0FBQSxxQkFBQXBGLFVBQUFFLElBQUEsZ0JBQ0EsSUFBQTRCLEVBQUFnRSxFQUFBOUQsRUFBQSxJQUFBLFdBRUFBLEdBQ0EsSUFBQUYsRUFBQS9CLEVBQUFpQyxFQUFBLEtBQ0E4RCxFQUFBOUYsVUFBQUUsSUFBQSxrQkFFQSxJQUFBNEIsRUFBQUYsRUFBQXdDLEdBQUFwQyxFQUFBLEtBQ0E4RCxFQUFBOUYsVUFBQUUsSUFBQSxlQUNBMEIsRUFBQXdDLEdBQUFnQixjQUFBLHFCQUFBcEYsVUFBQUMsT0FBQSxzQkFJQSxHQUNBMkIsRUFBQXdDLEdBQUFwRSxVQUFBK0UsU0FBQSwyQkFDQWhGLEVBQUFDLFVBQUErRSxTQUFBLDRCQUFBL0MsR0FDQWpDLEVBQUFDLFVBQUErRSxTQUFBLHdCQUFBL0MsRUFDQSxDQUNBLElBQUErRCxFQUFBdkUsU0FBQTRELGNBQUEsc0NBQ0FXLEVBQUEvRixVQUFBK0UsU0FBQSxlQUNBL0MsR0FDQStELEVBQUEvRixVQUFBQyxPQUFBLGVBQ0EsSUFBQWtFLEVBQUF2QyxFQUFBd0MsR0FBQWdCLGNBQUEscUJBQUFXLEVBQUEvRCxFQUFBLEtBQ0EsSUFBQUYsRUFBQWlFLEVBQUEvRCxFQUFBLElBQUEsWUFFQWpDLEVBQUFxRixjQUFBLFVBQUFwRixVQUFBQyxPQUFBLGdCQUNBLElBQUE2QixFQUFBL0IsRUFBQXFGLGNBQUEsVUFBQXBELEVBQUEsSUFBQSxXQUVBK0QsRUFBQS9GLFVBQUErRSxTQUFBLGlCQUNBZ0IsRUFBQS9GLFVBQUFDLE9BQUEsZ0JBQ0FGLEVBQUFxRixjQUFBLHFCQUFBcEYsVUFBQUUsSUFBQSxnQkFDQSxJQUFBNEIsRUFBQWlFLEVBQUEvRCxFQUFBLElBQUEsV0FFQUEsR0FDQSxJQUFBRixFQUFBaUUsRUFBQS9ELEVBQUEsSUFBQSxVQUNBK0QsRUFBQS9GLFVBQUFFLElBQUEsa0JBRUEsSUFBQTRCLEVBQUFGLEVBQUF3QyxHQUFBcEMsRUFBQSxLQUNBK0QsRUFBQS9GLFVBQUFFLElBQUEsZUFDQTBCLEVBQUF3QyxHQUFBZ0IsY0FBQSxxQkFBQXBGLFVBQUFDLE9BQUEsc0JBSUEsR0FDQTJCLEVBQUF3QyxHQUFBcEUsVUFBQStFLFNBQUEsdUJBQ0FoRixFQUFBQyxVQUFBK0UsU0FBQSx3QkFBQS9DLEdBQ0FqQyxFQUFBQyxVQUFBK0UsU0FBQSxvQkFBQS9DLEVBQ0EsQ0FDQSxJQUFBZ0UsRUFBQXhFLFNBQUE0RCxjQUFBLDhCQUNBWSxFQUFBaEcsVUFBQStFLFNBQUEsZUFDQS9DLEdBQ0FnRSxFQUFBaEcsVUFBQUMsT0FBQSxlQUNBLElBQUFrRSxFQUFBdkMsRUFBQXdDLEdBQUFnQixjQUFBLHFCQUFBWSxFQUFBaEUsRUFBQSxLQUNBLElBQUFGLEVBQUFrRSxFQUFBaEUsRUFBQSxJQUFBLFlBRUFKLEVBQUF3QyxHQUFBcEUsVUFBQUMsT0FBQSxlQUNBLElBQUE2QixFQUFBL0IsRUFBQWlDLEVBQUEsTUFFQWdFLEVBQUFoRyxVQUFBK0UsU0FBQSxpQkFDQWlCLEVBQUFoRyxVQUFBQyxPQUFBLGdCQUNBRixFQUFBcUYsY0FBQSxxQkFBQXBGLFVBQUFFLElBQUEsZ0JBQ0EsSUFBQTRCLEVBQUFrRSxFQUFBaEUsRUFBQSxJQUFBLFdBRUFBLEdBQ0EsSUFBQUYsRUFBQWtFLEVBQUFoRSxFQUFBLElBQUEsVUFDQWdFLEVBQUFoRyxVQUFBRSxJQUFBLGtCQUVBLElBQUE0QixFQUFBRixFQUFBd0MsR0FBQXBDLEVBQUEsS0FDQWdFLEVBQUFoRyxVQUFBRSxJQUFBLGVBQ0EwQixFQUFBd0MsR0FBQWdCLGNBQUEscUJBQUFwRixVQUFBQyxPQUFBLHNCQUtBLElBQUE2QixFQUFBL0IsRUFBQWlDLEVBQUEsTUFLQXpDLE9BQUFvQyxpQkFBQSxRQUFBNEMsR0FBQTBCLFNBQUEsSUFDQTFHLE9BQUFvQyxpQkFBQSxhQUFBNEMsR0FBQTBCLFNBQUEsSUFDQTFHLE9BQUFvQyxpQkFBQSxpQkFBQTRDLEdBQUEwQixTQUFBLElBRUEsSUFBQUMsRUFBQSxFQUNBMUUsU0FBQXdDLEtBQUFtQyxhQUFBLFNBQUE1RixHQUNBMkYsRUFBQTNGLEVBQUE2RixlQUFBLEdBQUFyRixTQUVBeEIsT0FBQW9DLGlCQUFBLFlBQUFwQixJQUVBLE1BQUE4RixFQUFBQyxLQUFBQyxNQUFBaEcsRUFBQTZGLGVBQUEsR0FBQUksU0FDQU4sSUFBQUcsR0FHQSxJQUFBOUIsRUFBQWhFLEVBREEyRixFQUFBRyxFQUFBLEtBb0JBLElBQUFJLE9BQUEsV0FDQUMsUUFBQSxFQUNBQyxRQUFBLEVBQ0FDLElBQUEsT0FDQUMsYUFDQUMsS0FDQUosUUFBQSxHQUVBSyxLQUNBTCxRQUFBLE1BSUFNIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsid2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgY29uc3Qgb2JzZXJ2ZXJPcHRpb25zID0ge1xuICAgIHJvb3Q6IG51bGwsXG4gICAgcm9vdE1hcmdpbjogXCIyNHB4XCIsXG4gICAgdGhyZXNob2xkOiAwLjVcbiAgfTtcblxuICBmdW5jdGlvbiBvYnNlcnZlckNhbGxiYWNrKGVudHJpZXMsIG9ic2VydmVyKSB7XG4gICAgZW50cmllcy5mb3JFYWNoKGVudHJ5ID0+IHtcbiAgICAgIGlmIChlbnRyeS5pc0ludGVyc2VjdGluZykge1xuICAgICAgICAvLyBmYWRlIGluIG9ic2VydmVkIGVsZW1lbnRzIHRoYXQgYXJlIGluIHZpZXdcbiAgICAgICAgZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtb2ZmJyk7XG4gICAgICAgIGVudHJ5LnRhcmdldC5jbGFzc0xpc3QuYWRkKCdhbmltYXRlJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBmYWRlIG91dCBvYnNlcnZlZCBlbGVtZW50cyB0aGF0IGFyZSBub3QgaW4gdmlld1xuICAgICAgICBlbnRyeS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZScpO1xuICAgICAgICBlbnRyeS50YXJnZXQuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZS1vZmYnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKG9ic2VydmVyQ2FsbGJhY2ssIG9ic2VydmVyT3B0aW9ucyk7XG5cbiAgY29uc3QgZmFkZUVsbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdzZWN0aW9uJyk7XG4gIGZhZGVFbG1zLmZvckVhY2goZWwgPT4gb2JzZXJ2ZXIub2JzZXJ2ZShlbCkpO1xuXG4gIGZ1bmN0aW9uIFBhcmFsbGF4KGUpIHtcbiAgICBsZXQgX3cgPSB3aW5kb3cuaW5uZXJXaWR0aC8yO1xuICAgIGxldCBfaCA9IHdpbmRvdy5pbm5lckhlaWdodC8yO1xuICAgIGxldCBfbW91c2VYID0gZS5jbGllbnRYO1xuICAgIGxldCBfbW91c2VZID0gZS5jbGllbnRZO1xuICAgIGxldCBlbGVtcyA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgnLnBhcmFsbGF4ZWQnKTtcbiAgICBlbGVtcy5mb3JFYWNoKChlbCwgaW5kZXgpID0+IHtcbiAgICAgIGxldCBtdWx0aXBseSA9IGluZGV4ICogLTAuMDAxIC0gMC4wMDE7XG4gICAgICBlbC5zdHlsZS5tYXJnaW5MZWZ0ID0gYCR7KF9tb3VzZVggLSBfdykgKiBtdWx0aXBseX0lYDtcbiAgICAgIGVsLnN0eWxlLm1hcmdpblRvcCA9IGAkeyhfbW91c2VZIC0gX2gpICogbXVsdGlwbHl9JWA7XG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBwYXJhbGxheGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBhcmFsbGF4Jyk7XG4gIHBhcmFsbGF4ZXMuZm9yRWFjaCgocGFyYWxsYXgpID0+IHtcbiAgICBwYXJhbGxheC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIFBhcmFsbGF4KTtcbiAgfSk7XG5cbiAgY29uc3Qgc2VjdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VjdGlvbicpO1xuXG4gIC8vIHNlY3Rpb25zLmZvckVhY2goKHNlY3Rpb24pID0+IHtcbiAgLy8gICBjb25zb2xlLmxvZyhzZWN0aW9uLmNsYXNzTGlzdCk7XG4gIC8vIH0pO1xuICBsZXQgaXNTY3JvbGxpbmcgPSBmYWxzZTtcblxuICBmdW5jdGlvbiBTY3JvbGwoZWxlbWVudCwgaXNEb3duLCBzcGVlZCwgdHlwZSkge1xuICAgIGlzU2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICBsZXQgc3RhcnQgPSBudWxsO1xuICAgIGxldCBmaXJzdFBvcyA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgIGxldCB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgbGV0IHRhcmdldCA9IDA7XG4gICAgbGV0IHBvcyA9IDA7XG5cbiAgICBpZiAodHlwZSA9PT0gJ2NlbnRlcicpIHtcbiAgICAgIHRhcmdldCA9IGlzRG93biA/ICh3aW5kb3dIZWlnaHQgKyBlbGVtZW50Lm9mZnNldEhlaWdodCkgLyAyIDogZWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCArICh3aW5kb3dIZWlnaHQgKyBlbGVtZW50Lm9mZnNldEhlaWdodCkgLyAyO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2JvdHRvbScpIHtcbiAgICAgIHRhcmdldCA9IGVsZW1lbnQucGFyZW50RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5ib3R0b20gLSB3aW5kb3dIZWlnaHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcmdldCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGZpcnN0UG9zLCB0YXJnZXQsIHBvcywgZWxlbWVudCk7XG5cbiAgICAoZnVuY3Rpb24oKSB7XG5cbiAgICAgIGNvbnN0IGJyb3dzZXIgPSBbJ21zJywgJ21veicsICd3ZWJraXQnLCAnbyddO1xuXG4gICAgICBmb3IobGV0IHggPSAwLCBsZW5ndGggPSBicm93c2VyLmxlbmd0aDsgeCA8IGxlbmd0aCAmJiAhd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZTsgeCsrKSB7XG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB3aW5kb3dbYnJvd3Nlclt4XSsnUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107XG4gICAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSA9IHdpbmRvd1ticm93c2VyW3hdKydDYW5jZWxBbmltYXRpb25GcmFtZSddIHx8IHdpbmRvd1ticm93c2VyW3hdKydDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcbiAgICAgIH1cblxuICAgIH0oKSk7XG5cbiAgICBmdW5jdGlvbiBzaG93QW5pbWF0aW9uICh0aW1lc3RhbXApIHtcblxuICAgICAgaWYoIXN0YXJ0KSB7IHN0YXJ0ID0gdGltZXN0YW1wIHx8IG5ldyBEYXRlKCkuZ2V0VGltZSgpOyB9IC8vZ2V0IGlkIG9mIGFuaW1hdGlvblxuXG4gICAgICBsZXQgZWxhcHNlZCA9IHRpbWVzdGFtcCAtIHN0YXJ0O1xuICAgICAgbGV0IHByb2dyZXNzID0gZWxhcHNlZCAvICtzcGVlZDsgLy8gYW5pbWF0aW9uIGR1cmF0aW9uIDUwMG1zXG4gICAgICBwcm9ncmVzcyA9ICtwcm9ncmVzcy50b0ZpeGVkKDIpO1xuXG4gICAgICAvLyBjb25zb2xlLmxvZyhzdGFydCwgdGltZXN0YW1wLCBwcm9ncmVzcywgZWxhcHNlZCwgc3BlZWQsIGZpcnN0UG9zLCB0YXJnZXQsIHBvcyk7XG5cbiAgICAgIC8vZWFzZSBpbiBmdW5jdGlvbiBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9jb21wb25lbnQvZWFzZS9ibG9iL21hc3Rlci9pbmRleC5qc1xuICAgICAgY29uc3Qgb3V0UXVhZCA9IGZ1bmN0aW9uKG4pe1xuICAgICAgICByZXR1cm4gbiAqICgyIC0gbik7XG4gICAgICB9O1xuXG4gICAgICBsZXQgZWFzZUluUGVyY2VudGFnZSA9ICsob3V0UXVhZChwcm9ncmVzcykpLnRvRml4ZWQoMik7XG5cbiAgICAgIHBvcyA9IGZpcnN0UG9zICsgKHRhcmdldCAqIGVhc2VJblBlcmNlbnRhZ2UpO1xuICAgICAgcG9zID0gK3Bvcy50b0ZpeGVkKDIpO1xuICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHBvcyk7XG5cbiAgICAgIC8vIGNvbnNvbGUubG9nKGZpcnN0UG9zLCB0YXJnZXQsIHBvcywgZWFzZUluUGVyY2VudGFnZSk7XG5cbiAgICAgIGlmKCBpc05hTihwb3MpIHx8IHBvcyA8IDAgfHxcbiAgICAgICAgIWlzRG93biAmJiBwb3MgPD0gMCB8fFxuICAgICAgICAhaXNEb3duICYmIHBvcyA8PSAoZmlyc3RQb3MgKyB0YXJnZXQgKyAxKSB8fFxuICAgICAgICBpc0Rvd24gJiYgcG9zID49IChmaXJzdFBvcyArIHRhcmdldCkgfHxcbiAgICAgICAgaXNEb3duICYmIHBvcyA+PSBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCAtIHdpbmRvdy5pbm5lckhlaWdodCAtIDEgfHxcbiAgICAgICAgcG9zID4gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQgLSB3aW5kb3cuaW5uZXJIZWlnaHQgKSB7XG4gICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHN0YXJ0KTtcbiAgICAgICAgaWYoZWxlbWVudCkge1xuICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgICBwb3MgPSAwO1xuICAgICAgICBpc1Njcm9sbGluZyA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzaG93QW5pbWF0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzaG93QW5pbWF0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIElubmVyU2Nyb2xsKGNvbnRhaW5lciwgZWxlbWVudHMsIGlzRG93bikge1xuICAgIGlzU2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICBsZXQgY29udGFpbmVyVG9wID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uX192YXJpYW50cycpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICBsZXQgcGFyZW50ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3VsJyk7XG4gICAgbGV0IGN1cnJlbnQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLnZhcmlhbnQtLWN1cnJlbnQnKTtcbiAgICBsZXQgdGFyZ2V0SW5kZXggPSBpc0Rvd24gP1xuICAgICAgQXJyYXkuZnJvbShlbGVtZW50cykuZmluZEluZGV4KCBlbCA9PiBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3ZhcmlhbnQtLWN1cnJlbnQnKSkgKyAxIDpcbiAgICAgIEFycmF5LmZyb20oZWxlbWVudHMpLmZpbmRJbmRleCggZWwgPT4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCd2YXJpYW50LS1jdXJyZW50JykpIC0gMTtcbiAgICBsZXQgdGFyZ2V0ID0gQXJyYXkuZnJvbShlbGVtZW50cylbdGFyZ2V0SW5kZXhdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICBsZXQgcG9zID0gMDtcbiAgICBpZiAocGFyZW50LnN0eWxlLnRyYW5zZm9ybSkge1xuICAgICAgbGV0IHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50KTtcbiAgICAgIGxldCBtYXRyaXggPSBuZXcgRE9NTWF0cml4UmVhZE9ubHkoc3R5bGUudHJhbnNmb3JtKTtcbiAgICAgIHBvcyA9IG1hdHJpeC5tNDI7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGNvbnRhaW5lclRvcCwgcGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCwgdGFyZ2V0LCBwb3MpO1xuICAgIGN1cnJlbnQuY2xhc3NMaXN0LnJlbW92ZSgndmFyaWFudC0tY3VycmVudCcpO1xuICAgIEFycmF5LmZyb20oZWxlbWVudHMpW3RhcmdldEluZGV4XS5jbGFzc0xpc3QuYWRkKCd2YXJpYW50LS1jdXJyZW50Jyk7XG4gICAgcGFyZW50LnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGVZKCR7Y29udGFpbmVyVG9wIC0gdGFyZ2V0ICsgcG9zfXB4KWA7XG4gICAgc2V0VGltZW91dCgoKSA9PiBpc1Njcm9sbGluZyA9IGZhbHNlLCAzMDApO1xuICB9XG5cbiAgZnVuY3Rpb24gU2xpZGVzU2Nyb2xsKGNvbnRhaW5lciwgZWxlbWVudHMsIGlzRG93bikge1xuICAgIGlzU2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICBsZXQgY3VycmVudCA9IEFycmF5LmZyb20oZWxlbWVudHMpLmZpbmRJbmRleChlbCA9PiBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3cnKSk7XG4gICAgbGV0IHRhcmdldCA9IGlzRG93biA/IGN1cnJlbnQgKyAxIDogY3VycmVudCAtIDE7XG4gICAgQXJyYXkuZnJvbShlbGVtZW50cylbY3VycmVudF0uY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICAgIEFycmF5LmZyb20oZWxlbWVudHMpW3RhcmdldF0uY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2xpZGUnLCArdGFyZ2V0KTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IGlzU2Nyb2xsaW5nID0gZmFsc2UsIDMwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBBbmltYXRlRmFkZShjdXJyZW50LCB0YXJnZXQsIGlkRG93biwgdGltZSkge1xuICAgIGlmICghKCFpZERvd24gJiYgdGFyZ2V0Lm9mZnNldEhlaWdodCA8IHdpbmRvdy5pbm5lckhlaWdodCkpIHtcbiAgICAgIGN1cnJlbnQuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgICB0YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gV2hlZWwoZSwgZG93bikge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBsZXQgaXNEb3duID0gZG93biB8fCBlLmRlbHRhWSA+IDA7XG4gICAgaWYgKCFpc1Njcm9sbGluZykge1xuICAgICAgbGV0IGN1cnJlbnQgPSBBcnJheS5mcm9tKHNlY3Rpb25zKS5maW5kSW5kZXgoc2VjdGlvbiA9PiBzZWN0aW9uLmNsYXNzTGlzdC5jb250YWlucygnYW5pbWF0ZScpKTtcbiAgICAgIGxldCB0YXJnZXQ7XG4gICAgICBpZiAoaXNEb3duKSB7XG4gICAgICAgIHRhcmdldCA9IGN1cnJlbnQgKyAxIDwgc2VjdGlvbnMubGVuZ3RoID8gQXJyYXkuZnJvbShzZWN0aW9ucylbY3VycmVudCArIDFdIDogQXJyYXkuZnJvbShzZWN0aW9ucylbY3VycmVudF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0YXJnZXQgPSBjdXJyZW50ID4gMCA/IEFycmF5LmZyb20oc2VjdGlvbnMpW2N1cnJlbnQgLSAxXSA6IEFycmF5LmZyb20oc2VjdGlvbnMpWzBdO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhzZWN0aW9uc1tjdXJyZW50XSwgdGFyZ2V0KTtcblxuICAgICAgaWYgKHNlY3Rpb25zW2N1cnJlbnRdLmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tdmFyaWFudHMnKSkge1xuICAgICAgICBsZXQgdmFyaWFudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VjdGlvbi0tdmFyaWFudHMgLnZhcmlhbnQnKTtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGlzRG93biAmJiB2YXJpYW50c1t2YXJpYW50cy5sZW5ndGggLSAxXS5jbGFzc0xpc3QuY29udGFpbnMoJ3ZhcmlhbnQtLWN1cnJlbnQnKSB8fFxuICAgICAgICAgICFpc0Rvd24gJiYgdmFyaWFudHNbMF0uY2xhc3NMaXN0LmNvbnRhaW5zKCd2YXJpYW50LS1jdXJyZW50JylcbiAgICAgICAgKSB7XG4gICAgICAgICAgbmV3IFNjcm9sbCh0YXJnZXQsIGlzRG93biwgNjAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuZXcgSW5uZXJTY3JvbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tLXZhcmlhbnRzJyksIHZhcmlhbnRzLCBpc0Rvd24pO1xuICAgICAgICB9XG5cbiAgICAgIH0gZWxzZSBpZiAoc2VjdGlvbnNbY3VycmVudF0uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWN0aW9uLS13b3JsZCcpKSB7XG4gICAgICAgIGxldCBzbGlkZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VjdGlvbi0td29ybGQgLnNlY3Rpb25fX3NsaWRlJyk7XG4gICAgICAgIGlmIChpc0Rvd24gJiYgc2xpZGVzW3NsaWRlcy5sZW5ndGggLSAxXS5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3cnKSB8fFxuICAgICAgICAgICFpc0Rvd24gJiYgc2xpZGVzWzBdLmNsYXNzTGlzdC5jb250YWlucygnc2hvdycpKSB7XG4gICAgICAgICAgbmV3IFNjcm9sbCh0YXJnZXQsIGlzRG93biwgNjAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuZXcgU2xpZGVzU2Nyb2xsKHNlY3Rpb25zW2N1cnJlbnRdLCBzbGlkZXMsIGlzRG93bik7XG4gICAgICAgIH1cblxuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgc2VjdGlvbnNbY3VycmVudF0uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWN0aW9uLS1yb2FkbWFwJykgfHxcbiAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tcm9hZG1hcCcpICYmICFpc0Rvd24gfHxcbiAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tb3Bwb3J0dW5pdGllcycpICYmICFpc0Rvd25cbiAgICAgICkge1xuICAgICAgICBsZXQgZXhwZXJ0aXNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tLXJvYWRtYXAgLmV4cGVydGlzZScpO1xuICAgICAgICBpZiAoZXhwZXJ0aXNlLmNsYXNzTGlzdC5jb250YWlucygnYW5pbWF0ZS1vZmYnKSkge1xuICAgICAgICAgIGlmIChpc0Rvd24pIHtcbiAgICAgICAgICAgIG5ldyBBbmltYXRlRmFkZShzZWN0aW9uc1tjdXJyZW50XS5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbl9fY29udGVudCcpLCBleHBlcnRpc2UsIGlzRG93biwgOTAwKTtcbiAgICAgICAgICAgIG5ldyBTY3JvbGwoZXhwZXJ0aXNlLCBpc0Rvd24sIDkwMCwgJ2JvdHRvbScpO1xuICAgICAgICAgICAgZXhwZXJ0aXNlLmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtb2ZmJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhcmdldC5xdWVyeVNlbGVjdG9yKCcuY29tbXVuaXR5JykuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgICAgICAgICBuZXcgU2Nyb2xsKHRhcmdldC5xdWVyeVNlbGVjdG9yKCcuY29tbXVuaXR5JyksIGlzRG93biwgOTAwLCAnY2VudGVyJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGV4cGVydGlzZS5jbGFzc0xpc3QuY29udGFpbnMoJ2FuaW1hdGUtZmFkZScpKSB7XG4gICAgICAgICAgZXhwZXJ0aXNlLmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtZmFkZScpO1xuICAgICAgICAgIHRhcmdldC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbl9fY29udGVudCcpLmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGUtZmFkZScpO1xuICAgICAgICAgIG5ldyBTY3JvbGwoZXhwZXJ0aXNlLCBpc0Rvd24sIDkwMCwgJ2JvdHRvbScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChpc0Rvd24pIHtcbiAgICAgICAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LCBpc0Rvd24sIDYwMCk7XG4gICAgICAgICAgICBleHBlcnRpc2UuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ldyBTY3JvbGwoc2VjdGlvbnNbY3VycmVudF0sIGlzRG93biwgNjAwKTtcbiAgICAgICAgICAgIGV4cGVydGlzZS5jbGFzc0xpc3QuYWRkKCdhbmltYXRlLW9mZicpO1xuICAgICAgICAgICAgc2VjdGlvbnNbY3VycmVudF0ucXVlcnlTZWxlY3RvcignLnNlY3Rpb25fX2NvbnRlbnQnKS5jbGFzc0xpc3QucmVtb3ZlKCdhbmltYXRlLWZhZGUnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgc2VjdGlvbnNbY3VycmVudF0uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWN0aW9uLS1vcHBvcnR1bml0aWVzJykgfHxcbiAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tb3Bwb3J0dW5pdGllcycpICYmICFpc0Rvd24gfHxcbiAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tYmFja3N0b3J5JykgJiYgIWlzRG93blxuICAgICAgKSB7XG4gICAgICAgIGxldCBjb21tdW5pdHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbi0tb3Bwb3J0dW5pdGllcyAuY29tbXVuaXR5Jyk7XG4gICAgICAgIGlmIChjb21tdW5pdHkuY2xhc3NMaXN0LmNvbnRhaW5zKCdhbmltYXRlLW9mZicpKSB7XG4gICAgICAgICAgaWYgKGlzRG93bikge1xuICAgICAgICAgICAgY29tbXVuaXR5LmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtb2ZmJyk7XG4gICAgICAgICAgICBuZXcgQW5pbWF0ZUZhZGUoc2VjdGlvbnNbY3VycmVudF0ucXVlcnlTZWxlY3RvcignLnNlY3Rpb25fX2NvbnRlbnQnKSwgY29tbXVuaXR5LCBpc0Rvd24sIDkwMCk7XG4gICAgICAgICAgICBuZXcgU2Nyb2xsKGNvbW11bml0eSwgaXNEb3duLCA5MDAsICdjZW50ZXInKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5wbGFjZScpLmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtZmFkZScpO1xuICAgICAgICAgICAgbmV3IFNjcm9sbCh0YXJnZXQucXVlcnlTZWxlY3RvcignLnBsYWNlJyksIGlzRG93biwgOTAwLCAnY2VudGVyJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGNvbW11bml0eS5jbGFzc0xpc3QuY29udGFpbnMoJ2FuaW1hdGUtZmFkZScpKSB7XG4gICAgICAgICAgY29tbXVuaXR5LmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtZmFkZScpO1xuICAgICAgICAgIHRhcmdldC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbl9fY29udGVudCcpLmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGUtZmFkZScpO1xuICAgICAgICAgIG5ldyBTY3JvbGwoY29tbXVuaXR5LCBpc0Rvd24sIDkwMCwgJ2NlbnRlcicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChpc0Rvd24pIHtcbiAgICAgICAgICAgIG5ldyBTY3JvbGwoY29tbXVuaXR5LCBpc0Rvd24sIDkwMCwgJ2NlbnRlcicpO1xuICAgICAgICAgICAgY29tbXVuaXR5LmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGUtZmFkZScpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuZXcgU2Nyb2xsKHNlY3Rpb25zW2N1cnJlbnRdLCBpc0Rvd24sIDYwMCk7XG4gICAgICAgICAgICBjb21tdW5pdHkuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZS1vZmYnKTtcbiAgICAgICAgICAgIHNlY3Rpb25zW2N1cnJlbnRdLnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uX19jb250ZW50JykuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIHNlY3Rpb25zW2N1cnJlbnRdLmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tYmFja3N0b3J5JykgfHxcbiAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2VjdGlvbi0tYmFja3N0b3J5JykgJiYgIWlzRG93biB8fFxuICAgICAgICB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWN0aW9uLS13b3JsZCcpICYmICFpc0Rvd25cbiAgICAgICkge1xuICAgICAgICBsZXQgcGxhY2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbi0tYmFja3N0b3J5IC5wbGFjZScpO1xuICAgICAgICBpZiAocGxhY2UuY2xhc3NMaXN0LmNvbnRhaW5zKCdhbmltYXRlLW9mZicpKSB7XG4gICAgICAgICAgaWYgKGlzRG93bikge1xuICAgICAgICAgICAgcGxhY2UuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZS1vZmYnKTtcbiAgICAgICAgICAgIG5ldyBBbmltYXRlRmFkZShzZWN0aW9uc1tjdXJyZW50XS5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbl9fY29udGVudCcpLCBwbGFjZSwgaXNEb3duLCA5MDApO1xuICAgICAgICAgICAgbmV3IFNjcm9sbChwbGFjZSwgaXNEb3duLCA5MDAsICdjZW50ZXInKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VjdGlvbnNbY3VycmVudF0uY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZS1vZmYnKTtcbiAgICAgICAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LCBpc0Rvd24sIDYwMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHBsYWNlLmNsYXNzTGlzdC5jb250YWlucygnYW5pbWF0ZS1mYWRlJykpIHtcbiAgICAgICAgICBwbGFjZS5jbGFzc0xpc3QucmVtb3ZlKCdhbmltYXRlLWZhZGUnKTtcbiAgICAgICAgICB0YXJnZXQucXVlcnlTZWxlY3RvcignLnNlY3Rpb25fX2NvbnRlbnQnKS5jbGFzc0xpc3QuYWRkKCdhbmltYXRlLWZhZGUnKTtcbiAgICAgICAgICBuZXcgU2Nyb2xsKHBsYWNlLCBpc0Rvd24sIDkwMCwgJ2NlbnRlcicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChpc0Rvd24pIHtcbiAgICAgICAgICAgIG5ldyBTY3JvbGwocGxhY2UsIGlzRG93biwgOTAwLCAnY2VudGVyJyk7XG4gICAgICAgICAgICBwbGFjZS5jbGFzc0xpc3QuYWRkKCdhbmltYXRlLWZhZGUnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3IFNjcm9sbChzZWN0aW9uc1tjdXJyZW50XSwgaXNEb3duLCA2MDApO1xuICAgICAgICAgICAgcGxhY2UuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZS1vZmYnKTtcbiAgICAgICAgICAgIHNlY3Rpb25zW2N1cnJlbnRdLnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uX19jb250ZW50JykuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZS1mYWRlJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ldyBTY3JvbGwodGFyZ2V0LCBpc0Rvd24sIDYwMCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgV2hlZWwsIHtwYXNzaXZlOiBmYWxzZX0pO1xuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V3aGVlbCcsIFdoZWVsLCB7cGFzc2l2ZTogZmFsc2V9KTtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU1vdXNlU2Nyb2xsJywgV2hlZWwsIHtwYXNzaXZlOiBmYWxzZX0pO1xuXG4gIGxldCB0b3VjaFN0YXJ0UG9zWSA9IDA7XG4gIGRvY3VtZW50LmJvZHkub250b3VjaHN0YXJ0ID0gZnVuY3Rpb24oZSl7XG4gICAgdG91Y2hTdGFydFBvc1kgPSBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFk7XG4gIH07XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCAoZSkgPT4ge1xuICAgIC8vIERpZmZlcmVudCBkZXZpY2VzIGdpdmUgZGlmZmVyZW50IHZhbHVlcyB3aXRoIGRpZmZlcmVudCBkZWNpbWFsIHBlcmNlbnRhZ2VzLlxuICAgIGNvbnN0IGN1cnJlbnRQYWdlWSA9IE1hdGgucm91bmQoZS5jaGFuZ2VkVG91Y2hlc1swXS5zY3JlZW5ZKTtcbiAgICBpZiAodG91Y2hTdGFydFBvc1kgPT09IGN1cnJlbnRQYWdlWSkgcmV0dXJuO1xuXG4gICAgaWYgKHRvdWNoU3RhcnRQb3NZIC0gY3VycmVudFBhZ2VZID4gMCkge1xuICAgICAgbmV3IFdoZWVsKGUsIHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXcgV2hlZWwoZSwgZmFsc2UpO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gZG9jdW1lbnQub25rZXl1cCA9IGZ1bmN0aW9uKGUpe1xuICAvLyAgIGNvbnNvbGUubG9nKCdLZXkgOiAnICsgZS5jb2RlKTtcbiAgLy8gICBsZXQgY3VycmVudCA9IEFycmF5LmZyb20oc2VjdGlvbnMpLmZpbmRJbmRleCggc2VjdGlvbiA9PiBzZWN0aW9uLmNsYXNzTGlzdC5jb250YWlucygnYW5pbWF0ZScpICk7XG4gIC8vICAgbGV0IHRhcmdldDtcbiAgLy8gICBpZiAoZS5jb2RlID09PSAoJ1NwYWNlJyB8fCAnQXJyb3dEb3duJyB8fCAnUGFnZURvd24nIHx8ICdEb3duJykpIHtcbiAgLy8gICAgIHRhcmdldCA9IGN1cnJlbnQgKyAxIDwgc2VjdGlvbnMubGVuZ3RoID8gQXJyYXkuZnJvbShzZWN0aW9ucylbY3VycmVudCArIDFdIDogQXJyYXkuZnJvbShzZWN0aW9ucylbY3VycmVudF07XG4gIC8vICAgICBuZXcgU2Nyb2xsKHRhcmdldCwgdHJ1ZSk7XG4gIC8vICAgfSBlbHNlIGlmIChlLmNvZGUgPT09ICgnQXJyb3dVcCcgfHwgJ1BhZ2VVcCcgfHwgJ1VwJykpIHtcbiAgLy8gICAgIHRhcmdldCA9IGN1cnJlbnQgPiAwID8gQXJyYXkuZnJvbShzZWN0aW9ucylbY3VycmVudCAtIDFdIDogQXJyYXkuZnJvbShzZWN0aW9ucylbMF07XG4gIC8vICAgICBuZXcgU2Nyb2xsKHRhcmdldCwgZmFsc2UpO1xuICAvLyAgIH1cbiAgLy8gfTtcblxuICBsZXQgc3BsaWRlID0gbmV3IFNwbGlkZSggJy5zcGxpZGUnLCB7XG4gICAgcGVyUGFnZTogMyxcbiAgICBwZXJNb3ZlOiAxLFxuICAgIGdhcCAgICA6ICczMnB4JyxcbiAgICBicmVha3BvaW50czoge1xuICAgICAgODIwOiB7XG4gICAgICAgIHBlclBhZ2U6IDJcbiAgICAgIH0sXG4gICAgICA1MjA6IHtcbiAgICAgICAgcGVyUGFnZTogMVxuICAgICAgfSxcbiAgICB9LFxuICB9ICk7XG4gIHNwbGlkZS5tb3VudCgpO1xufTtcblxuIl19
